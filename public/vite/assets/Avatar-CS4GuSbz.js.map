{"version":3,"file":"Avatar-CS4GuSbz.js","sources":["../../../app/javascript/shared/helpers/emoji.js","../../../app/javascript/dashboard/components-next/icon/provider.js","../../../app/javascript/dashboard/components-next/icon/ChannelIcon.vue","../../../app/javascript/dashboard/components-next/avatar/Avatar.vue"],"sourcesContent":["/**\n * Detects support for emoji character sets.\n *\n * Based on the Modernizr emoji detection.\n * https://github.com/Modernizr/Modernizr/blob/347ddb078116cee91b25b6e897e211b023f9dcb4/feature-detects/emoji.js\n *\n * @return {Boolean} true or false\n * @example\n *\n * hasEmojiSupport()\n * // => true|false\n */\nexport const hasEmojiSupport = () => {\n  const pixelRatio = window.devicePixelRatio || 1;\n  const offset = 12 * pixelRatio;\n  const node = document.createElement('canvas');\n\n  // canvastext support\n  if (\n    !node.getContext ||\n    !node.getContext('2d') ||\n    typeof node.getContext('2d').fillText !== 'function'\n  ) {\n    return false;\n  }\n\n  const ctx = node.getContext('2d');\n\n  ctx.fillStyle = '#f00';\n  ctx.textBaseline = 'top';\n  ctx.font = '32px Arial';\n  ctx.fillText('\\ud83d\\udc28', 0, 0); // U+1F428 KOALA\n  return ctx.getImageData(offset, offset, 1, 1).data[0] !== 0;\n};\n\nexport const removeEmoji = text => {\n  if (text) {\n    return text\n      .replace(\n        /([\\u2700-\\u27BF]|[\\uE000-\\uF8FF]|\\uD83C[\\uDC00-\\uDFFF]|\\uD83D[\\uDC00-\\uDFFF]|[\\u2011-\\u26FF]|\\uD83E[\\uDD10-\\uDDFF])/g,\n        ''\n      )\n      .replace(/\\s+/g, ' ')\n      .trim();\n  }\n  return '';\n};\n","import { computed } from 'vue';\n\nexport function useChannelIcon(inbox) {\n  const channelTypeIconMap = {\n    'Channel::Api': 'i-ri-cloudy-fill',\n    'Channel::Email': 'i-ri-mail-fill',\n    'Channel::FacebookPage': 'i-ri-messenger-fill',\n    'Channel::Line': 'i-ri-line-fill',\n    'Channel::Sms': 'i-ri-chat-1-fill',\n    'Channel::Telegram': 'i-ri-telegram-fill',\n    'Channel::TwilioSms': 'i-ri-chat-1-fill',\n    'Channel::TwitterProfile': 'i-ri-twitter-x-fill',\n    'Channel::WebWidget': 'i-ri-global-fill',\n    'Channel::Whatsapp': 'i-ri-whatsapp-fill',\n    'Channel::Instagram': 'i-ri-instagram-fill',\n    'Channel::Voice': 'i-ri-phone-fill',\n  };\n\n  const providerIconMap = {\n    microsoft: 'i-ri-microsoft-fill',\n    google: 'i-ri-google-fill',\n  };\n\n  const channelIcon = computed(() => {\n    const inboxDetails = inbox.value || inbox;\n    const type = inboxDetails.channel_type;\n    let icon = channelTypeIconMap[type];\n\n    if (type === 'Channel::Email' && inboxDetails.provider) {\n      if (Object.keys(providerIconMap).includes(inboxDetails.provider)) {\n        icon = providerIconMap[inboxDetails.provider];\n      }\n    }\n\n    // Special case for Twilio whatsapp\n    if (type === 'Channel::TwilioSms' && inboxDetails.medium === 'whatsapp') {\n      icon = 'i-ri-whatsapp-fill';\n    }\n\n    return icon ?? 'i-ri-global-fill';\n  });\n\n  return channelIcon;\n}\n","<script setup>\nimport { toRef } from 'vue';\nimport { useChannelIcon } from './provider';\nimport Icon from 'next/icon/Icon.vue';\n\nconst props = defineProps({\n  inbox: {\n    type: Object,\n    required: true,\n  },\n});\n\nconst channelIcon = useChannelIcon(toRef(props, 'inbox'));\n</script>\n\n<template>\n  <Icon :icon=\"channelIcon\" />\n</template>\n","<script setup>\nimport { computed, ref, watch } from 'vue';\nimport { useI18n } from 'vue-i18n';\nimport { removeEmoji } from 'shared/helpers/emoji';\n\nimport Icon from 'dashboard/components-next/icon/Icon.vue';\nimport ChannelIcon from 'dashboard/components-next/icon/ChannelIcon.vue';\nimport wootConstants from 'dashboard/constants/globals';\n\nconst props = defineProps({\n  src: {\n    type: String,\n    default: '',\n  },\n  name: {\n    type: String,\n    required: true,\n  },\n  size: {\n    type: Number,\n    default: 32,\n  },\n  allowUpload: {\n    type: Boolean,\n    default: false,\n  },\n  roundedFull: {\n    type: Boolean,\n    default: false,\n  },\n  status: {\n    type: String,\n    default: null,\n    validator: value =>\n      !value || wootConstants.AVAILABILITY_STATUS_KEYS.includes(value),\n  },\n  inbox: {\n    type: Object,\n    default: null,\n  },\n  iconName: {\n    type: String,\n    default: null,\n  },\n  hideOfflineStatus: {\n    type: Boolean,\n    default: false,\n  },\n});\n\nconst emit = defineEmits(['upload', 'delete']);\n\nconst { t } = useI18n();\n\nconst isImageValid = ref(true);\nconst fileInput = ref(null);\n\nconst AVATAR_COLORS = {\n  dark: [\n    ['#4B143D', '#FF8DCC'],\n    ['#3F220D', '#FFA366'],\n    ['#2A2A2A', '#ADB1B8'],\n    ['#023B37', '#0BD8B6'],\n    ['#27264D', '#A19EFF'],\n    ['#1D2E62', '#9EB1FF'],\n  ],\n  light: [\n    ['#FBDCEF', '#C2298A'],\n    ['#FFE0BB', '#99543A'],\n    ['#E8E8E8', '#60646C'],\n    ['#CCF3EA', '#008573'],\n    ['#EBEBFE', '#4747C2'],\n    ['#E1E9FF', '#3A5BC7'],\n  ],\n  default: { bg: '#E8E8E8', text: '#60646C' },\n};\n\nconst STATUS_CLASSES = computed(() => ({\n  online: 'bg-n-teal-10',\n  busy: 'bg-n-amber-10',\n  ...(props.hideOfflineStatus ? {} : { offline: 'bg-n-slate-10' }),\n}));\n\nconst showDefaultAvatar = computed(() => !props.src && !props.name);\n\nconst initials = computed(() => {\n  if (!props.name) return '';\n  const words = removeEmoji(props.name).split(/\\s+/);\n  return words.length === 1\n    ? words[0].charAt(0).toUpperCase()\n    : words\n        .slice(0, 2)\n        .map(word => word.charAt(0))\n        .join('')\n        .toUpperCase();\n});\n\nconst getColorsByNameLength = computed(() => {\n  if (!props.name) return AVATAR_COLORS.default;\n\n  const index = props.name.length % AVATAR_COLORS.light.length;\n  return {\n    bg: AVATAR_COLORS.light[index][0],\n    darkBg: AVATAR_COLORS.dark[index][0],\n    text: AVATAR_COLORS.light[index][1],\n    darkText: AVATAR_COLORS.dark[index][1],\n  };\n});\n\nconst containerStyles = computed(() => ({\n  width: `${props.size}px`,\n  height: `${props.size}px`,\n}));\n\nconst avatarStyles = computed(() => ({\n  ...containerStyles.value,\n  backgroundColor:\n    !showDefaultAvatar.value && (!props.src || !isImageValid.value)\n      ? getColorsByNameLength.value.bg\n      : undefined,\n  color:\n    !showDefaultAvatar.value && (!props.src || !isImageValid.value)\n      ? getColorsByNameLength.value.text\n      : undefined,\n  '--dark-bg': getColorsByNameLength.value.darkBg,\n  '--dark-text': getColorsByNameLength.value.darkText,\n}));\n\nconst badgeStyles = computed(() => {\n  const badgeSize = Math.max(props.size * 0.35, 8); // 35% of avatar size, minimum 8px\n  return {\n    width: `${badgeSize}px`,\n    height: `${badgeSize}px`,\n    top: `${props.size - badgeSize / 1.1}px`,\n    left: `${props.size - badgeSize / 1.1}px`,\n  };\n});\n\nconst iconStyles = computed(() => ({\n  fontSize: `${props.size / 1.6}px`,\n}));\n\nconst initialsStyles = computed(() => ({\n  fontSize: `${Math.min(props.size / 2.5, 24)}px`,\n}));\n\nconst invalidateCurrentImage = () => {\n  isImageValid.value = false;\n};\n\nconst handleUploadAvatar = () => {\n  fileInput.value.click();\n};\n\nconst handleImageUpload = event => {\n  const [file] = event.target.files;\n  if (file) {\n    emit('upload', {\n      file,\n      url: file ? URL.createObjectURL(file) : null,\n    });\n  }\n};\n\nconst handleDeleteAvatar = () => {\n  if (fileInput.value) {\n    fileInput.value.value = null;\n  }\n  emit('delete');\n};\n\nconst handleDismiss = event => {\n  event.stopPropagation();\n  handleDeleteAvatar();\n};\n\nwatch(\n  () => props.src,\n  () => {\n    isImageValid.value = true;\n  }\n);\n</script>\n\n<template>\n  <span\n    class=\"relative inline-flex group/avatar z-0 flex-shrink-0\"\n    :style=\"containerStyles\"\n  >\n    <!-- Status Badge -->\n    <slot name=\"badge\" :size=\"size\">\n      <div\n        v-if=\"status && STATUS_CLASSES[status]\"\n        class=\"absolute z-20 border rounded-full border-n-slate-3\"\n        :style=\"badgeStyles\"\n        :class=\"STATUS_CLASSES[status]\"\n      />\n      <div\n        v-if=\"inbox && !(status && STATUS_CLASSES[status])\"\n        :style=\"badgeStyles\"\n        class=\"absolute z-20 flex items-center justify-center rounded-full bg-n-solid-1 border border-transparent flex-shrink-0\"\n      >\n        <ChannelIcon :inbox=\"inbox\" class=\"w-full h-full text-n-slate-11\" />\n      </div>\n    </slot>\n\n    <!-- Delete Avatar Button -->\n    <div\n      v-if=\"src && allowUpload\"\n      class=\"absolute z-20 flex items-center justify-center invisible w-6 h-6 transition-all duration-300 ease-in-out opacity-0 cursor-pointer outline outline-1 outline-n-container -top-2 ltr:-right-2 rtl:-left-2 rounded-xl bg-n-solid-3 group-hover/avatar:visible group-hover/avatar:opacity-100\"\n      @click=\"handleDismiss\"\n    >\n      <Icon icon=\"i-lucide-x\" class=\"text-n-slate-11 size-4\" />\n    </div>\n\n    <!-- Avatar Container -->\n    <span\n      role=\"img\"\n      class=\"relative inline-flex items-center justify-center object-cover overflow-hidden font-medium\"\n      :class=\"[\n        roundedFull ? 'rounded-full' : 'rounded-xl',\n        {\n          'dark:!bg-[var(--dark-bg)] dark:!text-[var(--dark-text)]':\n            !showDefaultAvatar && (!src || !isImageValid),\n          'bg-n-slate-3 dark:bg-n-slate-4': showDefaultAvatar,\n        },\n      ]\"\n      :style=\"avatarStyles\"\n    >\n      <!-- Avatar Content -->\n      <img\n        v-if=\"src && isImageValid\"\n        :src=\"src\"\n        :alt=\"name\"\n        @error=\"invalidateCurrentImage\"\n      />\n\n      <template v-else>\n        <!-- Custom Icon -->\n        <Icon v-if=\"iconName\" :icon=\"iconName\" :style=\"iconStyles\" />\n\n        <!-- Initials -->\n        <span\n          v-else-if=\"!showDefaultAvatar\"\n          :style=\"initialsStyles\"\n          class=\"select-none\"\n        >\n          {{ initials }}\n        </span>\n\n        <!-- Fallback Icon if no name or image -->\n        <Icon\n          v-else\n          :title=\"t('THUMBNAIL.AUTHOR.NOT_AVAILABLE')\"\n          icon=\"i-lucide-user\"\n          :style=\"iconStyles\"\n        />\n      </template>\n\n      <!-- Upload Overlay and Input -->\n      <slot\n        v-if=\"allowUpload || $slots.overlay\"\n        name=\"overlay\"\n        :size=\"size\"\n        :handle-upload=\"handleUploadAvatar\"\n        :file-input-ref=\"fileInput\"\n        :handle-image-upload=\"handleImageUpload\"\n      >\n        <div\n          class=\"absolute inset-0 z-10 flex items-center justify-center invisible w-full h-full transition-all duration-300 ease-in-out opacity-0 rounded-xl bg-n-alpha-black1 group-hover/avatar:visible group-hover/avatar:opacity-100\"\n          @click=\"handleUploadAvatar\"\n        >\n          <Icon\n            icon=\"i-lucide-upload\"\n            class=\"text-white\"\n            :style=\"{ width: `${size / 2}px`, height: `${size / 2}px` }\"\n          />\n          <input\n            v-if=\"allowUpload\"\n            ref=\"fileInput\"\n            type=\"file\"\n            accept=\"image/png, image/jpeg, image/jpg, image/gif, image/webp\"\n            class=\"hidden\"\n            @change=\"handleImageUpload\"\n          />\n        </div>\n      </slot>\n    </span>\n  </span>\n</template>\n"],"names":["hasEmojiSupport","offset","node","ctx","removeEmoji","text","useChannelIcon","inbox","channelTypeIconMap","providerIconMap","computed","inboxDetails","type","icon","channelIcon","toRef","__props","props","emit","__emit","t","useI18n","isImageValid","ref","fileInput","AVATAR_COLORS","STATUS_CLASSES","showDefaultAvatar","initials","words","word","getColorsByNameLength","index","containerStyles","avatarStyles","badgeStyles","badgeSize","iconStyles","initialsStyles","invalidateCurrentImage","handleUploadAvatar","handleImageUpload","event","file","handleDeleteAvatar","handleDismiss","watch"],"mappings":"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"}