import{m as v,S as B,k as N,e as R,i as ae,t as j,C as re,o as ie}from"./globalConfig-DNoPylIh.js";import{g as O}from"./utils.esm-B9vk9JJa.js";import{C as le}from"./Button-DxetHAXU.js";import{F as E}from"./module-DBoux_do.js";import{_ as p,s as l,n as r,o,p as d,m as V,t as _,e as b,a as h,l as $,g as m,z as y,I as U,i as x,q as C,k as D,b as de,F as k,j as S,af as G,W as z,a1 as ce,f as H,ak as ue}from"./_plugin-vue_export-helper-BK9LWihk.js";import{I as me,t as X,J as he,R as ge,z as Y,L as pe,N as _e}from"./typing-DLDGfuj7.js";import{B as F}from"./Validators-U_Z_leEu.js";import{c as K,r as be,s as fe,I as W,A as ye,u as Ce}from"./widget-s9fkdOiY.js";import ve from"./EmojiInput-C1k9EJvN.js";import{f as Te,d as ke}from"./sharedFrameEvents-DuOMDK_J.js";import{u as P}from"./useMessageFormatter-BWcWDZNI.js";import{e as Se,r as Ee,u as Ae}from"./exports-C7nQ38Rb.js";import{T as Ie}from"./Thumbnail-CUjAwC9K.js";import{M as Z}from"./constants-lVAyZKq6.js";import{x as we,D as xe}from"./index-b3F7WOf6.js";import"./Icon-3PNIKml4.js";import"./index-DN3rM4CW.js";import"./_commonjsHelpers-BosuxZz1.js";import"./vue-dompurify-html-DajrD5x3.js";import"./index-BtuGy7By.js";import"./Branding-CGEOLrnb.js";const Me={name:"FooterReplyTo",components:{FluentIcon:E},props:{inReplyTo:{type:Object,default:()=>{}}},emits:["dismiss"],computed:{replyToAttachment(){var n,s;if(!((s=(n=this.inReplyTo)==null?void 0:n.attachments)!=null&&s.length))return"";const[{file_type:e}={}]=this.inReplyTo.attachments;return this.$t(`ATTACHMENTS.${e}.CONTENT`)}}},Re={class:"mb-2.5 rounded-[7px] dark:bg-slate-900 dark:text-slate-100 bg-slate-100 px-2 py-1.5 text-sm text-slate-700 flex items-center gap-2"},Fe={class:"items-center flex-grow truncate"};function Oe(e,n,s,u,i,t){const a=l("FluentIcon");return o(),r("div",Re,[d("div",Fe,[d("strong",null,_(e.$t("FOOTER_REPLY_TO.REPLY_TO")),1),V(" "+_(s.inReplyTo.content||t.replyToAttachment),1)]),d("button",{class:"items-end flex-shrink-0 p-1 rounded-md hover:bg-slate-200 dark:hover:bg-slate-800",onClick:n[0]||(n[0]=c=>e.$emit("dismiss"))},[b(a,{icon:"dismiss",size:"12"})])])}const Le=p(Me,[["render",Oe]]),Be={components:{FluentIcon:E,FileUpload:me,Spinner:B},props:{onAttach:{type:Function,default:()=>{}}},data(){return{isUploading:!1}},computed:{...v({globalConfig:"globalConfig/get"}),fileUploadSizeLimit(){return N},allowedFileTypes(){return ae}},mounted(){document.addEventListener("paste",this.handleClipboardPaste)},unmounted(){document.removeEventListener("paste",this.handleClipboardPaste)},methods:{handleClipboardPaste(e){const n=(e.clipboardData||e.originalEvent.clipboardData).items;Array.from(n).forEach(u=>{if(u.kind==="file"){e.preventDefault();const i=u.getAsFile();this.$refs.upload.add(i)}})},getFileType(e){return e.includes("image")?"image":"file"},async onFileUpload(e){this.globalConfig.directUploadsEnabled?await this.onDirectFileUpload(e):await this.onIndirectFileUpload(e)},async onDirectFileUpload(e){if(e){this.isUploading=!0;try{if(X(e,N)){const{websiteToken:n}=window.chatwootWebChannel;new he.DirectUpload(e.file,`/api/v1/widget/direct_uploads?website_token=${n}`,{directUploadWillCreateBlobWithXHR:u=>{u.setRequestHeader("X-Auth-Token",window.authToken)}}).create((u,i)=>{u?R.emit(F.SHOW_ALERT,{message:u}):this.onAttach({file:i.signed_id,...this.getLocalFileAttributes(e)})})}else R.emit(F.SHOW_ALERT,{message:this.$t("FILE_SIZE_LIMIT",{MAXIMUM_FILE_UPLOAD_SIZE:this.fileUploadSizeLimit})})}catch{}this.isUploading=!1}},async onIndirectFileUpload(e){if(e){this.isUploading=!0;try{X(e,N)?await this.onAttach({file:e.file,...this.getLocalFileAttributes(e)}):R.emit(F.SHOW_ALERT,{message:this.$t("FILE_SIZE_LIMIT",{MAXIMUM_FILE_UPLOAD_SIZE:this.fileUploadSizeLimit})})}catch{}this.isUploading=!1}},getLocalFileAttributes(e){return{thumbUrl:window.URL.createObjectURL(e.file),fileType:this.getFileType(e.type)}}}},Ue={class:"min-h-8 min-w-8 flex items-center justify-center"};function Ve(e,n,s,u,i,t){const a=l("FluentIcon"),c=l("Spinner"),g=l("FileUpload");return o(),h(g,{ref:"upload",size:4096*2048,accept:t.allowedFileTypes,data:{direct_upload_url:"/api/v1/widget/direct_uploads",direct_upload:!0},onInputFile:t.onFileUpload},{default:$(()=>[d("button",Ue,[i.isUploading.image?m("",!0):(o(),h(a,{key:0,icon:"attach"})),i.isUploading?(o(),h(c,{key:1,size:"small"})):m("",!0)])]),_:1},8,["accept","onInputFile"])}const $e=p(Be,[["render",Ve]]),De={components:{FluentIcon:E,Spinner:B},props:{loading:{type:Boolean,default:!1},disabled:{type:Boolean,default:!1},color:{type:String,default:"#6e6f73"}}},Pe=["disabled"];function Ne(e,n,s,u,i,t){const a=l("FluentIcon"),c=l("Spinner");return o(),r("button",{type:"submit",disabled:s.disabled,class:"min-h-8 min-w-8 flex items-center justify-center ml-1"},[s.loading?(o(),h(c,{key:1,size:"small"})):(o(),h(a,{key:0,icon:"send",style:y(`color: ${s.color}`)},null,8,["style"]))],8,Pe)}const je=p(De,[["render",Ne]]),We={name:"ChatInputWrap",components:{ChatAttachmentButton:$e,ChatSendButton:je,EmojiInput:ve,FluentIcon:E,ResizableTextArea:ge},mixins:[K],props:{onSendMessage:{type:Function,default:()=>{}},onSendAttachment:{type:Function,default:()=>{}}},data(){return{userInput:"",showEmojiPicker:!1,isFocused:!1}},computed:{...v({widgetColor:"appConfig/getWidgetColor",isWidgetOpen:"appConfig/getIsWidgetOpen"}),showAttachment(){return this.hasAttachmentsEnabled&&this.userInput.length===0},showSendButton(){return this.userInput.length>0}},watch:{isWidgetOpen(e){e&&this.focusInput()}},unmounted(){document.removeEventListener("keypress",this.handleEnterKeyPress)},mounted(){document.addEventListener("keypress",this.handleEnterKeyPress),this.isWidgetOpen&&this.focusInput()},methods:{onBlur(){this.isFocused=!1},onFocus(){this.isFocused=!0},handleButtonClick(){this.userInput&&this.userInput.trim()&&this.onSendMessage(this.userInput),this.userInput="",this.focusInput()},handleEnterKeyPress(e){e.keyCode===13&&!e.shiftKey&&(e.preventDefault(),this.handleButtonClick())},toggleEmojiPicker(){this.showEmojiPicker=!this.showEmojiPicker},hideEmojiPicker(e){this.showEmojiPicker&&(e.stopPropagation(),this.toggleEmojiPicker())},emojiOnClick(e){this.userInput=`${this.userInput}${e} `},onTypingOff(){this.toggleTyping("off")},onTypingOn(){this.toggleTyping("on")},toggleTyping(e){this.$store.dispatch("conversation/toggleUserTyping",{typingStatus:e})},focusInput(){this.$refs.chatInput.focus()}}},ze={class:"flex items-center ltr:pl-2 rtl:pr-2"},He=["aria-label"];function qe(e,n,s,u,i,t){const a=l("ResizableTextArea"),c=l("ChatAttachmentButton"),g=l("FluentIcon"),A=l("EmojiInput"),I=l("ChatSendButton"),M=U("on-clickaway");return o(),r("div",{class:C(["items-center flex ltr:pl-3 rtl:pr-3 ltr:pr-2 rtl:pl-2 rounded-[7px] transition-all duration-200 bg-n-background !shadow-[0_0_0_1px,0_0_2px_3px]",{"!shadow-n-brand dark:!shadow-n-brand":i.isFocused,"!shadow-n-strong dark:!shadow-n-strong":!i.isFocused}]),onKeydown:n[2]||(n[2]=D((...w)=>t.hideEmojiPicker&&t.hideEmojiPicker(...w),["esc"]))},[b(a,{id:"chat-input",ref:"chatInput",modelValue:i.userInput,"onUpdate:modelValue":n[0]||(n[0]=w=>i.userInput=w),rows:1,"aria-label":e.$t("CHAT_PLACEHOLDER"),placeholder:e.$t("CHAT_PLACEHOLDER"),class:"user-message-input reset-base",onTypingOff:t.onTypingOff,onTypingOn:t.onTypingOn,onFocus:t.onFocus,onBlur:t.onBlur},null,8,["modelValue","aria-label","placeholder","onTypingOff","onTypingOn","onFocus","onBlur"]),d("div",ze,[t.showAttachment?(o(),h(c,{key:0,class:"text-n-slate-12","on-attach":s.onSendAttachment},null,8,["on-attach"])):m("",!0),e.hasEmojiPickerEnabled?(o(),r("button",{key:1,class:"flex items-center justify-center min-h-8 min-w-8","aria-label":e.$t("EMOJI.ARIA_LABEL"),onClick:n[1]||(n[1]=(...w)=>t.toggleEmojiPicker&&t.toggleEmojiPicker(...w))},[b(g,{icon:"emoji",class:C(["transition-all duration-150",{"text-n-slate-12":!i.showEmojiPicker,"text-n-brand":i.showEmojiPicker}])},null,8,["class"])],8,He)):m("",!0),i.showEmojiPicker?x((o(),h(A,{key:2,"on-click":t.emojiOnClick,onKeydown:D(t.hideEmojiPicker,["esc"])},null,8,["on-click","onKeydown"])),[[M,t.hideEmojiPicker]]):m("",!0),t.showSendButton?(o(),h(I,{key:3,color:e.widgetColor,onClick:t.handleButtonClick},null,8,["color","onClick"])):m("",!0)])],34)}const Ge=p(We,[["render",qe],["__scopeId","data-v-84e1b3b2"]]),Xe={components:{ChatInputWrap:Ge,CustomButton:le,FooterReplyTo:Le},mixins:[be],data(){return{inReplyTo:null}},computed:{...v({conversationAttributes:"conversationAttributes/getConversationParams",widgetColor:"appConfig/getWidgetColor",conversationSize:"conversation/getConversationSize",currentUser:"contacts/getCurrentUser",isWidgetStyleFlat:"appConfig/isWidgetStyleFlat"}),textColor(){return O(this.widgetColor)},hideReplyBox(){const{allowMessagesAfterResolved:e}=window.chatwootWebChannel,{status:n}=this.conversationAttributes;return!e&&n==="resolved"},showEmailTranscriptButton(){return this.hasEmail},hasEmail(){return this.currentUser&&this.currentUser.has_email},hasReplyTo(){return this.inReplyTo&&(this.inReplyTo.content||this.inReplyTo.attachments)}},mounted(){R.on(F.TOGGLE_REPLY_TO_MESSAGE,this.toggleReplyTo)},methods:{...j("conversation",["sendMessage","sendAttachment","clearConversations"]),...j("conversationAttributes",["getAttributes","clearConversationAttributes"]),async handleSendMessage(e){await this.sendMessage({content:e,replyTo:this.inReplyTo?this.inReplyTo.id:null}),this.inReplyTo=null,this.conversationSize===0&&this.getAttributes()},async handleSendAttachment(e){await this.sendAttachment({attachment:e,replyTo:this.inReplyTo?this.inReplyTo.id:null}),this.inReplyTo=null},startNewConversation(){this.clearConversations(),this.clearConversationAttributes(),this.replaceRoute("prechat-form"),W.sendMessage({event:"onEvent",eventIdentifier:Te,data:{hasConversation:!0}})},toggleReplyTo(e){this.inReplyTo=e},async sendTranscript(){if(this.hasEmail)try{await fe(),R.emit(F.SHOW_ALERT,{message:this.$t("EMAIL_TRANSCRIPT.SEND_EMAIL_SUCCESS"),type:"success"})}catch{R.$emit(F.SHOW_ALERT,{message:this.$t("EMAIL_TRANSCRIPT.SEND_EMAIL_ERROR")})}}}},Ye={key:1};function Ke(e,n,s,u,i,t){const a=l("FooterReplyTo"),c=l("ChatInputWrap"),g=l("CustomButton");return t.hideReplyBox?(o(),r("div",Ye,[b(g,{class:"font-medium",block:"","bg-color":e.widgetColor,"text-color":t.textColor,onClick:t.startNewConversation},{default:$(()=>[V(_(e.$t("START_NEW_CONVERSATION")),1)]),_:1},8,["bg-color","text-color","onClick"]),t.showEmailTranscriptButton?(o(),h(g,{key:0,type:"clear",class:"font-normal",onClick:t.sendTranscript},{default:$(()=>[V(_(e.$t("EMAIL_TRANSCRIPT.BUTTON_TEXT")),1)]),_:1},8,["onClick"])):m("",!0)])):(o(),r("footer",{key:0,class:C(["relative z-50 mb-1",{"rounded-lg":!e.isWidgetStyleFlat,"pt-2.5 shadow-[0px_-20px_20px_1px_rgba(0,_0,_0,_0.05)] dark:shadow-[0px_-20px_20px_1px_rgba(0,_0,_0,_0.15)] rounded-t-none":t.hasReplyTo}])},[t.hasReplyTo?(o(),h(a,{key:0,"in-reply-to":i.inReplyTo,onDismiss:n[0]||(n[0]=A=>i.inReplyTo=null)},null,8,["in-reply-to"])):m("",!0),b(c,{class:"shadow-sm","on-send-message":t.handleSendMessage,"on-send-attachment":t.handleSendAttachment},null,8,["on-send-message","on-send-attachment"])],2))}const Ze=p(Xe,[["render",Ke]]),Je={name:"UserMessageBubble",props:{message:{type:String,default:""},widgetColor:{type:String,default:""}},setup(){const{formatMessage:e}=P();return{formatMessage:e}},computed:{textColor(){return O(this.widgetColor)}}};function Qe(e,n,s,u,i,t){const a=U("dompurify-html");return x((o(),r("div",{class:"chat-bubble user",style:y({background:s.widgetColor,color:t.textColor})},null,4)),[[a,u.formatMessage(s.message,!1)]])}const et=p(Je,[["render",Qe],["__scopeId","data-v-651a0452"]]),tt={name:"MessageReplyButton",components:{FluentIcon:E}},st={class:"p-1 mb-1 rounded-full dark:text-slate-500 dark:bg-slate-900 text-slate-600 bg-slate-100 hover:text-slate-800"};function nt(e,n,s,u,i,t){const a=l("FluentIcon");return o(),r("button",st,[b(a,{icon:"arrow-reply",size:"11",class:"flex-shrink-0"})])}const J=p(tt,[["render",nt]]),ot={props:{url:{type:String,default:""},thumb:{type:String,default:""},readableTime:{type:String,default:""}},emits:["error"],methods:{onImgError(){this.$emit("error")}}},at=["href"],rt={class:"wrap"},it=["src"],lt={class:"time"};function dt(e,n,s,u,i,t){return o(),r("a",{href:s.url,target:"_blank",rel:"noreferrer noopener nofollow",class:"image"},[d("div",rt,[d("img",{src:s.thumb,alt:"Picture message",onError:n[0]||(n[0]=(...a)=>t.onImgError&&t.onImgError(...a))},null,40,it),d("span",lt,_(s.readableTime),1)])],8,at)}const Q=p(ot,[["render",dt],["__scopeId","data-v-f077030b"]]),ct={class:"relative block max-w-full"},ut=["src"],mt={class:"absolute text-xs text-white dark:text-white right-3 bottom-1 whitespace-nowrap"},ee={__name:"VideoBubble",props:{url:{type:String,default:""},readableTime:{type:String,default:""}},emits:["error"],setup(e,{emit:n}){const s=n,u=()=>{s("error")};return(i,t)=>(o(),r("div",ct,[d("video",{class:"w-full max-w-[250px] h-auto",src:e.url,controls:"",onError:u},null,40,ut),d("span",mt,_(e.readableTime),1)]))}},ht={components:{FluentIcon:E},props:{url:{type:String,default:""},isInProgress:{type:Boolean,default:!1},widgetColor:{type:String,default:""},isUserBubble:{type:Boolean,default:!1}},computed:{title(){return this.isInProgress?this.$t("COMPONENTS.FILE_BUBBLE.UPLOADING"):decodeURI(this.fileName)},fileName(){return this.url.substring(this.url.lastIndexOf("/")+1)},contrastingTextColor(){return O(this.widgetColor)},textColor(){return this.isUserBubble&&this.widgetColor?this.contrastingTextColor:""}},methods:{openLink(){window.open(this.url,"_blank").focus()}}},gt={class:"file flex flex-row items-center p-3 cursor-pointer"},pt={class:"ltr:pr-1 rtl:pl-1"},_t={class:"leading-none mb-1"},bt=["href"];function ft(e,n,s,u,i,t){const a=l("FluentIcon");return o(),r("div",gt,[d("div",{class:"icon-wrap",style:y({color:t.textColor})},[b(a,{icon:"document",size:"28"})],4),d("div",pt,[d("div",{class:C(["m-0 font-medium text-sm",{"text-n-slate-12":!s.isUserBubble}]),style:y({color:t.textColor})},_(t.title),7),d("div",_t,[d("a",{class:"download",rel:"noreferrer noopener nofollow",target:"_blank",style:y({color:t.textColor}),href:s.url},_(e.$t("COMPONENTS.FILE_BUBBLE.DOWNLOAD")),13,bt)])])])}const te=p(ht,[["render",ft],["__scopeId","data-v-7ea48b19"]]),se={computed:{messageContentAttributes(){const{content_attributes:e={}}=this.message;return e},hasAttachments(){return!!(this.message.attachments&&this.message.attachments.length>0)}}},yt={name:"AgentMessage",components:{FluentIcon:E},props:{replyTo:{type:Object,default:()=>{}}},data(){return{timeOutID:null}},computed:{replyToAttachment(){var n,s;if(!((s=(n=this.replyTo)==null?void 0:n.attachments)!=null&&s.length))return"";const[{file_type:e}={}]=this.replyTo.attachments;return this.$t(`ATTACHMENTS.${e}.CONTENT`)}},unmounted(){clearTimeout(this.timeOutID)},methods:{navigateTo(e){const n=`cwmsg-${e}`;this.$nextTick(()=>{const s=document.getElementById(n);s.scrollIntoView(),s.classList.add("bg-slate-100","dark:bg-slate-900"),this.timeOutID=setTimeout(()=>{s.classList.remove("bg-slate-100","dark:bg-slate-900")},500)})}}},Ct={class:"truncate max-w-[8rem]"};function vt(e,n,s,u,i,t){const a=l("FluentIcon");return o(),r("button",{class:"px-1.5 py-0.5 rounded-md text-slate-500 bg-slate-50 dark:bg-slate-900 opacity-60 hover:opacity-100 cursor-pointer flex items-center gap-1.5",onClick:n[0]||(n[0]=c=>t.navigateTo(s.replyTo.id))},[b(a,{icon:"arrow-reply",size:"12",class:"flex-shrink-0"}),d("div",Ct,_(s.replyTo.content||t.replyToAttachment),1)])}const ne=p(yt,[["render",vt]]),Tt={name:"DragWrapper",props:{direction:{type:String,required:!0,validator:e=>["left","right"].includes(e)},disabled:{type:Boolean,default:!1}},emits:["dragged"],data(){return{startX:null,dragDistance:0,threshold:50}},methods:{handleTouchStart(e){this.disabled||(this.startX=e.touches[0].clientX)},handleTouchMove(e){if(this.disabled)return;let s=e.touches[0].clientX-this.startX;this.direction==="right"?this.dragDistance=Math.min(this.threshold,s):this.direction==="left"&&(this.dragDistance=Math.max(-this.threshold,s))},resetPosition(){(this.dragDistance>=this.threshold&&this.direction==="right"||this.dragDistance<=-this.threshold&&this.direction==="left")&&this.$emit("dragged",this.direction),this.dragDistance=0}}};function kt(e,n,s,u,i,t){return o(),r("div",{style:y({transform:`translateX(${i.dragDistance}px)`}),class:"will-change-transform",onTouchstart:n[0]||(n[0]=(...a)=>t.handleTouchStart&&t.handleTouchStart(...a)),onTouchmove:n[1]||(n[1]=(...a)=>t.handleTouchMove&&t.handleTouchMove(...a)),onTouchend:n[2]||(n[2]=(...a)=>t.resetPosition&&t.resetPosition(...a))},[de(e.$slots,"default")],36)}const St=p(Tt,[["render",kt]]),Et={name:"UserMessage",components:{UserMessageBubble:et,MessageReplyButton:J,ImageBubble:Q,VideoBubble:ee,FileBubble:te,FluentIcon:E,ReplyToChip:ne,DragWrapper:St},mixins:[se],props:{message:{type:Object,default:()=>{}},replyTo:{type:Object,default:()=>{}}},data(){return{hasImageError:!1,hasVideoError:!1}},computed:{...v({widgetColor:"appConfig/getWidgetColor"}),isInProgress(){const{status:e=""}=this.message;return e==="in_progress"},showTextBubble(){const{message:e}=this;return!!e.content},readableTime(){const{created_at:e=""}=this.message;return Y(e)},isFailed(){const{status:e=""}=this.message;return e==="failed"},errorMessage(){const{meta:e}=this.message;return e?e.error:this.$t("COMPONENTS.MESSAGE_BUBBLE.ERROR_MESSAGE")},hasReplyTo(){return this.replyTo&&(this.replyTo.content||this.replyTo.attachments)}},watch:{message(){this.hasImageError=!1,this.hasVideoError=!1}},mounted(){this.hasImageError=!1,this.hasVideoError=!1},methods:{async retrySendMessage(){await this.$store.dispatch("conversation/sendMessageWithData",this.message)},onImageLoadError(){this.hasImageError=!0},onVideoLoadError(){this.hasVideoError=!0},toggleReply(){R.emit(F.TOGGLE_REPLY_TO_MESSAGE,this.message)}}},At={class:"user-message-wrap group"},It={class:"flex gap-1 user-message"},wt={key:0,class:"flex justify-end mt-2 mb-1 text-xs"},xt={class:"flex justify-end gap-1"},Mt={class:"flex flex-col justify-end"},Rt={key:1,class:"flex justify-end px-4 py-2 text-n-ruby-9 align-middle"},Ft=["title"];function Ot(e,n,s,u,i,t){const a=l("ReplyToChip"),c=l("MessageReplyButton"),g=l("UserMessageBubble"),A=l("ImageBubble"),I=l("VideoBubble"),M=l("FileBubble"),w=l("DragWrapper"),L=l("FluentIcon");return o(),r("div",At,[d("div",It,[d("div",{class:C(["message-wrap",{"in-progress":t.isInProgress,"is-failed":t.isFailed}])},[t.hasReplyTo?(o(),r("div",wt,[b(a,{"reply-to":s.replyTo},null,8,["reply-to"])])):m("",!0),d("div",xt,[d("div",Mt,[!t.isInProgress&&!t.isFailed?(o(),h(c,{key:0,class:"transition-opacity delay-75 opacity-0 group-hover:opacity-100 sm:opacity-0",onClick:t.toggleReply},null,8,["onClick"])):m("",!0)]),b(w,{direction:"left",onDragged:t.toggleReply},{default:$(()=>[t.showTextBubble?(o(),h(g,{key:0,message:s.message.content,status:s.message.status,"widget-color":e.widgetColor},null,8,["message","status","widget-color"])):m("",!0),e.hasAttachments?(o(),r("div",{key:1,class:"chat-bubble has-attachment user",style:y({backgroundColor:e.widgetColor})},[(o(!0),r(k,null,S(s.message.attachments,f=>(o(),r("div",{key:f.id},[f.file_type==="image"&&!i.hasImageError?(o(),h(A,{key:0,url:f.data_url,thumb:f.data_url,"readable-time":t.readableTime,onError:t.onImageLoadError},null,8,["url","thumb","readable-time","onError"])):m("",!0),f.file_type==="video"&&!i.hasVideoError?(o(),h(I,{key:1,url:f.data_url,"readable-time":t.readableTime,onError:t.onVideoLoadError},null,8,["url","readable-time","onError"])):(o(),h(M,{key:2,url:f.data_url,"is-in-progress":t.isInProgress,"widget-color":e.widgetColor,"is-user-bubble":""},null,8,["url","is-in-progress","widget-color"]))]))),128))],4)):m("",!0)]),_:1},8,["onDragged"])]),t.isFailed?(o(),r("div",Rt,[e.hasAttachments?m("",!0):(o(),r("button",{key:0,title:e.$t("COMPONENTS.MESSAGE_BUBBLE.RETRY"),class:"inline-flex items-center justify-center ltr:ml-2 rtl:mr-2",onClick:n[0]||(n[0]=(...f)=>t.retrySendMessage&&t.retrySendMessage(...f))},[b(L,{icon:"arrow-clockwise",size:"14"})],8,Ft))])):m("",!0)],2)])])}const oe=p(Et,[["render",Ot]]),Lt={components:{},props:{action:{type:Object,default:()=>{}}},computed:{...v({widgetColor:"appConfig/getWidgetColor"}),textColor(){return O(this.widgetColor)},isLink(){return this.action.type==="link"}},methods:{onClick(){this.action.type==="postback"&&W.isIFrame()&&W.sendMessage({event:"postback",data:{payload:this.action.payload}})}}},Bt=["href"];function Ut(e,n,s,u,i,t){return t.isLink?(o(),r("a",{key:s.action.uri,class:"action-button button",href:s.action.uri,style:y({background:e.widgetColor,borderColor:e.widgetColor,color:t.textColor}),target:"_blank",rel:"noopener nofollow noreferrer"},_(s.action.text),13,Bt)):(o(),r("button",{key:s.action.payload,class:"action-button button !bg-n-background dark:!bg-n-alpha-black1 text-n-brand",style:y({borderColor:e.widgetColor,color:e.widgetColor}),onClick:n[0]||(n[0]=(...a)=>t.onClick&&t.onClick(...a))},_(s.action.text),5))}const Vt=p(Lt,[["render",Ut],["__scopeId","data-v-eccbcf5d"]]),$t={components:{CardButton:Vt},props:{title:{type:String,default:""},description:{type:String,default:""},mediaUrl:{type:String,default:""},actions:{type:Array,default:()=>[]}}},Dt={class:"card-message chat-bubble agent bg-n-background dark:bg-n-solid-3 max-w-56 rounded-lg overflow-hidden"},Pt=["src"],Nt={class:"card-body"},jt={class:"!text-base !font-medium !mt-1 !mb-1 !leading-[1.5] text-n-slate-12"},Wt={class:"!mb-1 text-n-slate-11"};function zt(e,n,s,u,i,t){const a=l("CardButton");return o(),r("div",Dt,[d("img",{class:"w-full object-contain max-h-[150px] rounded-[5px]",src:s.mediaUrl},null,8,Pt),d("div",Nt,[d("h4",jt,_(s.title),1),d("p",Wt,_(s.description),1),(o(!0),r(k,null,S(s.actions,c=>(o(),h(a,{key:c.id,action:c},null,8,["action"]))),128))])])}const Ht=p($t,[["render",zt]]),qt={props:{buttonLabel:{type:String,default:""},items:{type:Array,default:()=>[]},submittedValues:{type:Array,default:()=>[]}},emits:["submit"],data(){return{formValues:{},hasSubmitted:!1}},computed:{...v({widgetColor:"appConfig/getWidgetColor"}),textColor(){return O(this.widgetColor)},isFormValid(){return this.items.reduce((e,{name:n})=>!!this.formValues[n]&&e,!0)}},mounted(){this.submittedValues.length?this.updateFormValues():this.setFormDefaults()},methods:{onSubmitClick(){this.hasSubmitted=!0},onSubmit(){this.isFormValid&&this.$emit("submit",this.formValues)},buildFormObject(e){return e.reduce((n,s)=>({...n,[s.name]:s.value||s.default}),{})},updateFormValues(){this.formValues=this.buildFormObject(this.submittedValues)},setFormDefaults(){this.formValues=this.buildFormObject(this.items)}}},Gt={class:"form chat-bubble agent w-full p-4 bg-n-background dark:bg-n-solid-3"},Xt={class:"text-n-slate-12"},Yt=["onUpdate:modelValue","type","pattern","title","required","name","placeholder","disabled"],Kt=["onUpdate:modelValue","required","pattern","title","type","name","placeholder","disabled"],Zt=["onUpdate:modelValue","required","title","name","placeholder","disabled"],Jt=["onUpdate:modelValue","required"],Qt=["value"],es={class:"error-message"};function ts(e,n,s,u,i,t){return o(),r("div",Gt,[d("form",{onSubmit:n[1]||(n[1]=H((...a)=>t.onSubmit&&t.onSubmit(...a),["prevent"]))},[(o(!0),r(k,null,S(s.items,a=>(o(),r("div",{key:a.key,class:C(["pb-2 w-full",{"has-submitted":i.hasSubmitted}])},[d("label",Xt,_(a.label),1),a.type==="email"?x((o(),r("input",{key:0,"onUpdate:modelValue":c=>i.formValues[a.name]=c,type:a.type,pattern:a.regex,title:a.title,required:a.required&&"required",name:a.name,placeholder:a.placeholder,disabled:!!s.submittedValues.length},null,8,Yt)),[[G,i.formValues[a.name]]]):a.type==="text"?x((o(),r("input",{key:1,"onUpdate:modelValue":c=>i.formValues[a.name]=c,required:a.required&&"required",pattern:a.pattern,title:a.title,type:a.type,name:a.name,placeholder:a.placeholder,disabled:!!s.submittedValues.length},null,8,Kt)),[[G,i.formValues[a.name]]]):a.type==="text_area"?x((o(),r("textarea",{key:2,"onUpdate:modelValue":c=>i.formValues[a.name]=c,required:a.required&&"required",title:a.title,name:a.name,placeholder:a.placeholder,disabled:!!s.submittedValues.length},null,8,Zt)),[[z,i.formValues[a.name]]]):a.type==="select"?x((o(),r("select",{key:3,"onUpdate:modelValue":c=>i.formValues[a.name]=c,required:a.required&&"required"},[(o(!0),r(k,null,S(a.options,c=>(o(),r("option",{key:c.key,value:c.value},_(c.label),9,Qt))),128))],8,Jt)),[[ce,i.formValues[a.name]]]):m("",!0),d("span",es,_(a.pattern_error||e.$t("CHAT_FORM.INVALID.FIELD")),1)],2))),128)),s.submittedValues.length?m("",!0):(o(),r("button",{key:0,class:"button block",type:"submit",style:y({background:e.widgetColor,borderColor:e.widgetColor,color:t.textColor}),onClick:n[0]||(n[0]=(...a)=>t.onSubmitClick&&t.onSubmitClick(...a))},_(s.buttonLabel||e.$t("COMPONENTS.FORM_BUBBLE.SUBMIT")),5))],32)])}const ss=p(qt,[["render",ts],["__scopeId","data-v-663a5cdb"]]),ns={components:{},props:{action:{type:Object,default:()=>{}},isSelected:{type:Boolean,default:!1}},emits:["optionSelect"],computed:{...v({widgetColor:"appConfig/getWidgetColor"})},methods:{onClick(){this.$emit("optionSelect",this.action)}}};function os(e,n,s,u,i,t){return o(),r("li",{class:C(["option",{"is-selected":s.isSelected}]),style:y({borderColor:e.widgetColor})},[d("button",{class:"option-button button",onClick:n[0]||(n[0]=(...a)=>t.onClick&&t.onClick(...a))},[d("span",{style:y({color:e.widgetColor})},_(s.action.title),5)])],6)}const as=p(ns,[["render",os],["__scopeId","data-v-74ee74cc"]]),rs={components:{ChatOption:as},props:{title:{type:String,default:""},options:{type:Array,default:()=>[]},selected:{type:String,default:""},hideFields:{type:Boolean,default:!1}},emits:["optionSelect"],setup(){const{formatMessage:e}=P();return{formatMessage:e}},methods:{isSelected(e){return this.selected===e.id},onClick(e){this.$emit("optionSelect",e)}}},is={class:"chat-bubble agent max-w-64 !py-2 !px-4 rounded-lg overflow-hidden mt-1 bg-n-background dark:bg-n-solid-3"},ls={class:"text-n-slate-12 text-sm font-normal my-1 leading-[1.5]"},ds={class:"text-n-slate-12"},cs={key:0,class:"w-full"};function us(e,n,s,u,i,t){const a=l("ChatOption"),c=U("dompurify-html");return o(),r("div",is,[d("h4",ls,[x(d("div",ds,null,512),[[c,u.formatMessage(s.title,!1)]])]),s.hideFields?m("",!0):(o(),r("ul",cs,[(o(!0),r(k,null,S(s.options,g=>(o(),h(a,{key:g.id,action:g,"is-selected":t.isSelected(g),class:"list-none p-0",onOptionSelect:t.onClick},null,8,["action","is-selected","onOptionSelect"]))),128))]))])}const ms=p(rs,[["render",us]]),hs={components:{FluentIcon:E},props:{items:{type:Array,default:()=>[]}},setup(){const{truncateMessage:e}=P();return{truncateMessage:e}}},gs={key:0,class:"chat-bubble agent bg-n-background dark:bg-n-solid-3"},ps=["href"],_s={class:"flex items-center text-black-900 font-medium"},bs={class:"text-n-slate-12"},fs={class:"block mt-1 text-n-slate-12"};function ys(e,n,s,u,i,t){const a=l("FluentIcon");return s.items.length?(o(),r("div",gs,[(o(!0),r(k,null,S(s.items,c=>(o(),r("div",{key:c.link,class:"border-b border-solid border-n-weak text-sm py-2 px-0 last:border-b-0"},[d("a",{href:c.link,target:"_blank",rel:"noopener noreferrer nofollow",class:"text-n-slate-12 no-underline"},[d("span",_s,[b(a,{icon:"link",class:"ltr:mr-1 rtl:ml-1 text-n-slate-12"}),d("span",bs,_(c.title),1)]),d("span",fs,_(u.truncateMessage(c.description)),1)],8,ps)]))),128))])):m("",!0)}const Cs=p(hs,[["render",ys]]),vs={components:{FluentIcon:E,Spinner:B},props:{messageId:{type:Number,required:!0},messageContentAttributes:{type:Object,default:()=>{}}},setup(){return{v$:Ae()}},data(){return{email:"",isUpdating:!1}},computed:{...v({widgetColor:"appConfig/getWidgetColor"}),textColor(){return O(this.widgetColor)},hasSubmitted(){return this.messageContentAttributes&&this.messageContentAttributes.submitted_email}},validations:{email:{required:Ee,email:Se}},methods:{async onSubmit(){if(!this.v$.$invalid){this.isUpdating=!0;try{await this.$store.dispatch("message/update",{email:this.email,messageId:this.messageId})}catch{}finally{this.isUpdating=!1}}}}},Ts=["placeholder"],ks=["disabled"];function Ss(e,n,s,u,i,t){const a=l("FluentIcon"),c=l("Spinner");return o(),r("div",null,[t.hasSubmitted?m("",!0):(o(),r("form",{key:0,class:"email-input-group h-10 flex my-2 mx-0 min-w-[200px]",onSubmit:n[3]||(n[3]=H((...g)=>t.onSubmit&&t.onSubmit(...g),["prevent"]))},[x(d("input",{"onUpdate:modelValue":n[0]||(n[0]=g=>i.email=g),type:"email",placeholder:e.$t("EMAIL_PLACEHOLDER"),class:C({error:u.v$.email.$error}),onInput:n[1]||(n[1]=(...g)=>u.v$.email.$touch&&u.v$.email.$touch(...g)),onKeydown:n[2]||(n[2]=D((...g)=>t.onSubmit&&t.onSubmit(...g),["enter"]))},null,42,Ts),[[z,i.email]]),d("button",{class:"button small",disabled:u.v$.email.$invalid,style:y({background:e.widgetColor,borderColor:e.widgetColor,color:t.textColor})},[i.isUpdating?(o(),h(c,{key:1,class:"mx-2"})):(o(),h(a,{key:0,icon:"chevron-right"}))],12,ks)],32))])}const Es=p(vs,[["render",Ss],["__scopeId","data-v-c0f153df"]]),As={components:{Spinner:B,FluentIcon:E},props:{messageContentAttributes:{type:Object,default:()=>{}},messageId:{type:Number,required:!0}},data(){return{email:"",ratings:re,selectedRating:null,isUpdating:!1,feedback:""}},computed:{...v({widgetColor:"appConfig/getWidgetColor"}),isRatingSubmitted(){var e,n;return(n=(e=this.messageContentAttributes)==null?void 0:e.csat_survey_response)==null?void 0:n.rating},isFeedbackSubmitted(){var e,n;return(n=(e=this.messageContentAttributes)==null?void 0:e.csat_survey_response)==null?void 0:n.feedback_message},isButtonDisabled(){return!(this.selectedRating&&this.feedback)},textColor(){return O(this.widgetColor)},title(){return this.isRatingSubmitted?this.$t("CSAT.SUBMITTED_TITLE"):this.$t("CSAT.TITLE")}},mounted(){if(this.isRatingSubmitted){const{csat_survey_response:{rating:e,feedback_message:n}}=this.messageContentAttributes;this.selectedRating=e,this.feedback=n}},methods:{buttonClass(e){return[{selected:e.value===this.selectedRating},{disabled:this.isRatingSubmitted},{hover:this.isRatingSubmitted},"emoji-button"]},async onSubmit(){this.isUpdating=!0;try{await this.$store.dispatch("message/update",{submittedValues:{csat_survey_response:{rating:this.selectedRating,feedback_message:this.feedback}},messageId:this.messageId})}catch{}finally{this.isUpdating=!1}},selectRating(e){this.selectedRating=e.value,this.onSubmit()}}},Is={class:"text-n-slate-12 text-sm font-medium pt-5 px-2.5 text-center"},ws={class:"ratings flex justify-around py-5 px-4"},xs=["onClick"],Ms=["placeholder"],Rs=["disabled"];function Fs(e,n,s,u,i,t){const a=l("Spinner"),c=l("FluentIcon");return o(),r("div",{class:"customer-satisfaction w-full bg-n-background dark:bg-n-solid-3 shadow-[0_0.25rem_6px_rgba(50,50,93,0.08),0_1px_3px_rgba(0,0,0,0.05)] ltr:rounded-bl-[0.25rem] rtl:rounded-br-[0.25rem] rounded-lg inline-block leading-[1.5] mt-1 border-t-2 border-t-n-brand border-solid",style:y({borderColor:e.widgetColor})},[d("h6",Is,_(t.title),1),d("div",ws,[(o(!0),r(k,null,S(i.ratings,g=>(o(),r("button",{key:g.key,class:C(t.buttonClass(g)),onClick:A=>t.selectRating(g)},_(g.emoji),11,xs))),128))]),t.isFeedbackSubmitted?m("",!0):(o(),r("form",{key:0,class:"feedback-form flex",onSubmit:n[2]||(n[2]=H(g=>t.onSubmit(),["prevent"]))},[x(d("input",{"onUpdate:modelValue":n[0]||(n[0]=g=>i.feedback=g),placeholder:e.$t("CSAT.PLACEHOLDER"),onKeydown:n[1]||(n[1]=D((...g)=>t.onSubmit&&t.onSubmit(...g),["enter"]))},null,40,Ms),[[z,i.feedback]]),d("button",{class:"button small",disabled:t.isButtonDisabled,style:y({background:e.widgetColor,borderColor:e.widgetColor,color:t.textColor})},[i.isUpdating&&i.feedback?(o(),h(a,{key:0})):(o(),h(c,{key:1,icon:"chevron-right"}))],12,Rs)],32))],4)}const Os=p(As,[["render",Fs],["__scopeId","data-v-cc061eb3"]]),Ls={addParticipantToDyteMeeting:e=>{const s={url:`/api/v1/widget/integrations/dyte/add_participant_to_meeting${ke(window.location.search)}`};return ye.post(s.url,{message_id:e})}},Bs={components:{FluentIcon:E},props:{messageId:{type:Number,required:!0}},data(){return{isLoading:!1,dyteAuthToken:"",isSDKMounted:!1}},computed:{...v({widgetColor:"appConfig/getWidgetColor"}),textColor(){return O(this.widgetColor)},meetingLink(){return pe(this.dyteAuthToken)}},methods:{async joinTheCall(){this.isLoading=!0;try{const e=await Ls.addParticipantToDyteMeeting(this.messageId),{data:{token:n}={}}=e;this.dyteAuthToken=n}catch{}finally{this.isLoading=!1}},leaveTheRoom(){this.dyteAuthToken=""}}},Us=["is-loading"],Vs={key:0,class:"video-call--container"},$s=["src"];function Ds(e,n,s,u,i,t){const a=l("FluentIcon");return o(),r("div",null,[d("button",{class:"button join-call-button","color-scheme":"secondary","is-loading":i.isLoading,style:y({background:e.widgetColor,borderColor:e.widgetColor,color:t.textColor}),onClick:n[0]||(n[0]=(...c)=>t.joinTheCall&&t.joinTheCall(...c))},[b(a,{icon:"video-add",class:"rtl:ml-2 ltr:mr-2"}),V(" "+_(e.$t("INTEGRATIONS.DYTE.CLICK_HERE_TO_JOIN")),1)],12,Us),i.dyteAuthToken?(o(),r("div",Vs,[d("iframe",{src:t.meetingLink,allow:"camera;microphone;fullscreen;display-capture;picture-in-picture;clipboard-write;"},null,8,$s),d("button",{class:"button small join-call-button leave-room-button",onClick:n[1]||(n[1]=(...c)=>t.leaveTheRoom&&t.leaveTheRoom(...c))},_(e.$t("INTEGRATIONS.DYTE.LEAVE_THE_ROOM")),1)])):m("",!0)])}const Ps=p(Bs,[["render",Ds],["__scopeId","data-v-9ee75e88"]]),Ns={name:"AgentMessageBubble",components:{ChatArticle:Cs,ChatCard:Ht,ChatForm:ss,ChatOptions:ms,EmailInput:Es,CustomerSatisfaction:Os,IntegrationCard:Ps},props:{message:{type:String,default:null},contentType:{type:String,default:null},messageType:{type:Number,default:null},messageId:{type:Number,default:null},messageContentAttributes:{type:Object,default:()=>{}}},setup(){const{formatMessage:e,getPlainText:n,truncateMessage:s,highlightContent:u}=P();return{formatMessage:e,getPlainText:n,truncateMessage:s,highlightContent:u}},computed:{isTemplate(){return this.messageType===3},isTemplateEmail(){return this.contentType==="input_email"},isCards(){return this.contentType==="cards"},isOptions(){return this.contentType==="input_select"},isForm(){return this.contentType==="form"},isArticle(){return this.contentType==="article"},isCSAT(){return this.contentType==="input_csat"},isIntegrations(){return this.contentType==="integrations"}},methods:{onResponse(e){this.$store.dispatch("message/update",e)},onOptionSelect(e){this.onResponse({submittedValues:[e],messageId:this.messageId})},onFormSubmit(e){const n=Object.keys(e).map(s=>({name:s,value:e[s]}));this.onResponse({submittedValues:n,messageId:this.messageId})}}},js={class:"chat-bubble-wrap"},Ws={key:0,class:"chat-bubble agent bg-n-background dark:bg-n-solid-3 text-n-slate-12"},zs={class:"message-content text-n-slate-12"},Hs={key:1},qs={key:3},Gs={key:4};function Xs(e,n,s,u,i,t){const a=l("EmailInput"),c=l("IntegrationCard"),g=l("ChatOptions"),A=l("ChatForm"),I=l("ChatCard"),M=l("ChatArticle"),w=l("CustomerSatisfaction"),L=U("dompurify-html");return o(),r("div",js,[!t.isCards&&!t.isOptions&&!t.isForm&&!t.isArticle&&!t.isCards&&!t.isCSAT?(o(),r("div",Ws,[x(d("div",zs,null,512),[[L,u.formatMessage(s.message,!1)]]),t.isTemplateEmail?(o(),h(a,{key:0,"message-id":s.messageId,"message-content-attributes":s.messageContentAttributes},null,8,["message-id","message-content-attributes"])):m("",!0),t.isIntegrations?(o(),h(c,{key:1,"message-id":s.messageId,"meeting-data":s.messageContentAttributes.data},null,8,["message-id","meeting-data"])):m("",!0)])):m("",!0),t.isOptions?(o(),r("div",Hs,[b(g,{title:s.message,options:s.messageContentAttributes.items,"hide-fields":!!s.messageContentAttributes.submitted_values,onOptionSelect:t.onOptionSelect},null,8,["title","options","hide-fields","onOptionSelect"])])):m("",!0),t.isForm&&!s.messageContentAttributes.submitted_values?(o(),h(A,{key:2,items:s.messageContentAttributes.items,"button-label":s.messageContentAttributes.button_label,"submitted-values":s.messageContentAttributes.submitted_values,onSubmit:t.onFormSubmit},null,8,["items","button-label","submitted-values","onSubmit"])):m("",!0),t.isCards?(o(),r("div",qs,[(o(!0),r(k,null,S(s.messageContentAttributes.items,f=>(o(),h(I,{key:f.title,"media-url":f.media_url,title:f.title,description:f.description,actions:f.actions},null,8,["media-url","title","description","actions"]))),128))])):m("",!0),t.isArticle?(o(),r("div",Gs,[b(M,{items:s.messageContentAttributes.items},null,8,["items"])])):m("",!0),t.isCSAT?(o(),h(w,{key:5,"message-content-attributes":s.messageContentAttributes.submitted_values,"message-id":s.messageId},null,8,["message-content-attributes","message-id"])):m("",!0)])}const Ys=p(Ns,[["render",Xs]]),Ks={name:"AgentMessage",components:{AgentMessageBubble:Ys,ImageBubble:Q,VideoBubble:ee,Thumbnail:Ie,UserMessage:oe,FileBubble:te,MessageReplyButton:J,ReplyToChip:ne},mixins:[K,se],props:{message:{type:Object,default:()=>{}},replyTo:{type:Object,default:()=>{}}},data(){return{hasImageError:!1,hasVideoError:!1}},computed:{shouldDisplayAgentMessage(){return this.contentType==="input_select"&&this.messageContentAttributes.submitted_values&&!this.message.content?!1:this.message.content},readableTime(){const{created_at:e=""}=this.message;return Y(e,"LLL d yyyy, h:mm a")},messageType(){const{message_type:e=1}=this.message;return e},contentType(){const{content_type:e=""}=this.message;return e},agentName(){return this.message.sender?this.message.sender.available_name||this.message.sender.name:this.useInboxAvatarForBot?this.channelConfig.websiteName:this.$t("UNREAD_VIEW.BOT")},avatarUrl(){const e=this.useInboxAvatarForBot?this.inboxAvatarUrl:"/assets/images/chatwoot_bot.png";return this.message.message_type===Z.TEMPLATE?e:this.message.sender?this.message.sender.avatar_url:e},hasRecordedResponse(){return this.messageContentAttributes.submitted_email||this.messageContentAttributes.submitted_values&&!["form","input_csat"].includes(this.contentType)},responseMessage(){if(this.messageContentAttributes.submitted_email)return{content:this.messageContentAttributes.submitted_email};if(this.messageContentAttributes.submitted_values&&this.contentType==="input_select"){const[e={}]=this.messageContentAttributes.submitted_values;return{content:e.title||e.value}}return""},isASubmittedForm(){return we(this.message)},submittedFormValues(){return this.messageContentAttributes.submitted_values.map(e=>({id:e.name,content:e.value}))},wrapClass(){return{"has-text":this.shouldDisplayAgentMessage}},hasReplyTo(){return this.replyTo&&(this.replyTo.content||this.replyTo.attachments)}},watch:{message(){this.hasImageError=!1,this.hasVideoError=!1}},mounted(){this.hasImageError=!1,this.hasVideoError=!1},methods:{onImageLoadError(){this.hasImageError=!0},onVideoLoadError(){this.hasVideoError=!0},toggleReply(){R.emit(F.TOGGLE_REPLY_TO_MESSAGE,this.message)}}},Zs={key:0,class:"agent-message"},Js={class:"avatar-wrap"},Qs={class:"message-wrap"},en={key:0,class:"flex mt-2 mb-1 text-xs"},tn={class:"flex w-full gap-1"},sn={key:2,controls:"",class:"h-10 dark:invert"},nn=["src"],on={class:"flex flex-col justify-end"},an={key:1,class:"agent-name text-n-slate-11"},rn={key:2};function ln(e,n,s,u,i,t){var q;const a=l("Thumbnail"),c=l("ReplyToChip"),g=l("AgentMessageBubble"),A=l("ImageBubble"),I=l("VideoBubble"),M=l("FileBubble"),w=l("MessageReplyButton"),L=l("UserMessage"),f=U("dompurify-html");return o(),r("div",{class:C(["agent-message-wrap group",{"has-response":t.hasRecordedResponse||t.isASubmittedForm}])},[t.isASubmittedForm?m("",!0):(o(),r("div",Zs,[d("div",Js,[s.message.showAvatar||t.hasRecordedResponse?(o(),h(a,{key:0,src:t.avatarUrl,size:"24px",username:t.agentName},null,8,["src","username"])):m("",!0)]),d("div",Qs,[t.hasReplyTo?(o(),r("div",en,[b(c,{"reply-to":s.replyTo},null,8,["reply-to"])])):m("",!0),d("div",tn,[d("div",{class:C(["space-y-2",{"w-full":t.contentType==="form"&&!((q=e.messageContentAttributes)!=null&&q.submitted_values)}])},[t.shouldDisplayAgentMessage?(o(),h(g,{key:0,"content-type":t.contentType,"message-content-attributes":e.messageContentAttributes,"message-id":s.message.id,"message-type":t.messageType,message:s.message.content},null,8,["content-type","message-content-attributes","message-id","message-type","message"])):m("",!0),e.hasAttachments?(o(),r("div",{key:1,class:C(["space-y-2 chat-bubble has-attachment agent bg-n-background dark:bg-n-solid-3",t.wrapClass])},[(o(!0),r(k,null,S(s.message.attachments,T=>(o(),r("div",{key:T.id},[T.file_type==="image"&&!i.hasImageError?(o(),h(A,{key:0,url:T.data_url,thumb:T.data_url,"readable-time":t.readableTime,onError:t.onImageLoadError},null,8,["url","thumb","readable-time","onError"])):m("",!0),T.file_type==="video"&&!i.hasVideoError?(o(),h(I,{key:1,url:T.data_url,"readable-time":t.readableTime,onError:t.onVideoLoadError},null,8,["url","readable-time","onError"])):T.file_type==="audio"?(o(),r("audio",sn,[d("source",{src:T.data_url},null,8,nn)])):(o(),h(M,{key:3,url:T.data_url},null,8,["url"]))]))),128))],2)):m("",!0)],2),d("div",on,[b(w,{class:"transition-opacity delay-75 opacity-0 group-hover:opacity-100 sm:opacity-0",onClick:t.toggleReply},null,8,["onClick"])])]),s.message.showAvatar||t.hasRecordedResponse?x((o(),r("p",an,null,512)),[[f,t.agentName]]):m("",!0)])])),t.hasRecordedResponse?(o(),h(L,{key:1,message:t.responseMessage},null,8,["message"])):m("",!0),t.isASubmittedForm?(o(),r("div",rn,[(o(!0),r(k,null,S(t.submittedFormValues,T=>(o(),h(L,{key:T.id,message:T},null,8,["message"]))),128))])):m("",!0)],2)}const dn=p(Ks,[["render",ln]]),cn={components:{AgentMessage:dn,UserMessage:oe},props:{message:{type:Object,default:()=>{}}},computed:{...v({allMessages:"conversation/getConversation"}),isUserMessage(){return this.message.message_type===Z.INCOMING},replyTo(){var n,s;const e=(s=(n=this.message)==null?void 0:n.content_attributes)==null?void 0:s.in_reply_to;return e?this.allMessages[e]:null}}};function un(e,n,s,u,i,t){const a=l("UserMessage"),c=l("AgentMessage");return t.isUserMessage?(o(),h(a,{key:0,id:`cwmsg-${s.message.id}`,message:s.message,"reply-to":t.replyTo},null,8,["id","message","reply-to"])):(o(),h(c,{key:1,id:`cwmsg-${s.message.id}`,message:s.message,"reply-to":t.replyTo},null,8,["id","message","reply-to"]))}const mn=p(cn,[["render",un],["__scopeId","data-v-41d8b669"]]),hn={name:"AgentTypingBubble"},gn={class:"agent-message-wrap sticky bottom-1"};function pn(e,n,s,u,i,t){return o(),r("div",gn,n[0]||(n[0]=[ue('<div class="agent-message" data-v-718caf0a><div class="avatar-wrap" data-v-718caf0a></div><div class="message-wrap mt-2" data-v-718caf0a><div class="chat-bubble agent typing-bubble bg-n-background dark:bg-n-solid-3" data-v-718caf0a><img src="'+_e+'" alt="Agent is typing a message" class="!w-full" data-v-718caf0a></div></div></div>',1)]))}const _n=p(hn,[["render",pn],["__scopeId","data-v-718caf0a"]]),bn={props:{date:{type:String,required:!0}},computed:{formattedDate(){return xe({date:this.date,todayText:this.$t("TODAY"),yesterdayText:this.$t("YESTERDAY")})}}},fn={class:"text-sm text-n-slate-11 h-[50px] leading-[50px] relative text-center w-full before:content-[''] before:h-px before:absolute before:top-6 before:w-[calc((100%-120px)/2)] before:bg-n-slate-4 before:dark:bg-n-slate-6 before:left-0 after:content-[''] after:h-px after:absolute after:top-6 after:w-[calc((100%-120px)/2)] after:bg-n-slate-4 after:dark:bg-n-slate-6 after:right-0"};function yn(e,n,s,u,i,t){return o(),r("div",fn,_(t.formattedDate),1)}const Cn=p(bn,[["render",yn]]),vn={name:"ConversationWrap",components:{ChatMessage:mn,AgentTypingBubble:_n,DateSeparator:Cn,Spinner:B},props:{groupedMessages:{type:Array,default:()=>[]}},setup(){const{darkMode:e}=Ce();return{darkMode:e}},data(){return{previousScrollHeight:0,previousConversationSize:0}},computed:{...v({earliestMessage:"conversation/getEarliestMessage",lastMessage:"conversation/getLastMessage",allMessagesLoaded:"conversation/getAllMessagesLoaded",isFetchingList:"conversation/getIsFetchingList",conversationSize:"conversation/getConversationSize",isAgentTyping:"conversation/getIsAgentTyping",conversationAttributes:"conversationAttributes/getConversationParams"}),colorSchemeClass(){return`${this.darkMode==="dark"?"dark-scheme":"light-scheme"}`},showStatusIndicator(){const{status:e}=this.conversationAttributes,n=e==="pending",s=this.lastMessage.message_type===ie.INCOMING;return this.isAgentTyping||n&&s}},watch:{allMessagesLoaded(){this.previousScrollHeight=0}},mounted(){this.$el.addEventListener("scroll",this.handleScroll),this.scrollToBottom()},updated(){this.previousConversationSize!==this.conversationSize&&(this.previousConversationSize=this.conversationSize,this.scrollToBottom())},unmounted(){this.$el.removeEventListener("scroll",this.handleScroll)},methods:{...j("conversation",["fetchOldConversations"]),scrollToBottom(){const e=this.$el;e.scrollTop=e.scrollHeight-this.previousScrollHeight,this.previousScrollHeight=0},handleScroll(){this.isFetchingList||this.allMessagesLoaded||!this.conversationSize||this.$el.scrollTop<100&&(this.fetchOldConversations({before:this.earliestMessage.id}),this.previousScrollHeight=this.$el.scrollHeight)}}},Tn={key:0,class:"message--loader"};function kn(e,n,s,u,i,t){const a=l("Spinner"),c=l("DateSeparator"),g=l("ChatMessage"),A=l("AgentTypingBubble");return o(),r("div",{class:C(["conversation--container",t.colorSchemeClass])},[d("div",{class:C(["conversation-wrap",{"is-typing":e.isAgentTyping}])},[e.isFetchingList?(o(),r("div",Tn,[b(a)])):m("",!0),(o(!0),r(k,null,S(s.groupedMessages,I=>(o(),r("div",{key:I.date,class:"messages-wrap"},[b(c,{date:I.date},null,8,["date"]),(o(!0),r(k,null,S(I.messages,M=>(o(),h(g,{key:M.id,message:M},null,8,["message"]))),128))]))),128)),t.showStatusIndicator?(o(),h(A,{key:1})):m("",!0)],2)],2)}const Sn=p(vn,[["render",kn],["__scopeId","data-v-a6ec1f69"]]),En={components:{ChatFooter:Ze,ConversationWrap:Sn},computed:{...v({groupedMessages:"conversation/getGroupedConversation"})},mounted(){this.$store.dispatch("conversation/setUserLastSeen")}},An={class:"flex flex-col flex-1 overflow-hidden rounded-b-lg bg-n-slate-2 dark:bg-n-solid-1"},In={class:"flex flex-1 overflow-auto"};function wn(e,n,s,u,i,t){const a=l("ConversationWrap"),c=l("ChatFooter");return o(),r("div",An,[d("div",In,[b(a,{"grouped-messages":e.groupedMessages},null,8,["grouped-messages"])]),b(c,{class:"px-5"})])}const Kn=p(En,[["render",wn]]);export{Kn as default};
