{"version":3,"file":"PreChatForm-D0HURtNj.js","sources":["../../../app/javascript/widget/components/Form/PhoneInput.vue","../../../app/javascript/widget/components/PreChat/Form.vue","../../../app/javascript/widget/views/PreChatForm.vue"],"sourcesContent":["<script setup>\nimport { ref, computed, watch, useTemplateRef, nextTick, unref } from 'vue';\nimport countriesList from 'shared/constants/countries.js';\nimport FluentIcon from 'shared/components/FluentIcon/Index.vue';\nimport {\n  getActiveCountryCode,\n  getActiveDialCode,\n} from 'shared/components/PhoneInput/helper';\n\nconst { context } = defineProps({\n  context: {\n    type: Object,\n    default: () => ({}),\n  },\n});\n\nconst localValue = ref(context.value || '');\n\nconst selectedIndex = ref(-1);\nconst showDropdown = ref(false);\nconst searchCountry = ref('');\nconst activeCountryCode = ref(getActiveCountryCode());\nconst activeDialCode = ref(getActiveDialCode());\nconst phoneNumber = ref('');\n\nconst dropdownRef = useTemplateRef('dropdownRef');\nconst searchbarRef = useTemplateRef('searchbarRef');\n\nconst placeholder = computed(() => context?.attrs?.placeholder || '');\nconst hasErrorInPhoneInput = computed(() => context?.state?.invalid);\nconst dropdownFirstItemName = computed(() =>\n  activeCountryCode.value ? 'Clear selection' : 'Select Country'\n);\nconst countries = computed(() => [\n  {\n    name: dropdownFirstItemName.value,\n    dial_code: '',\n    emoji: '',\n    id: '',\n  },\n  ...countriesList,\n]);\n\nconst items = computed(() => {\n  return countries.value.filter(country => {\n    const { name, dial_code, id } = country;\n    const search = searchCountry.value.toLowerCase();\n    return (\n      name.toLowerCase().includes(search) ||\n      dial_code.toLowerCase().includes(search) ||\n      id.toLowerCase().includes(search)\n    );\n  });\n});\n\nconst activeCountry = computed(() => {\n  return countries.value.find(\n    country => country.id === activeCountryCode.value\n  );\n});\n\nwatch(items, newItems => {\n  if (newItems.length < selectedIndex.value + 1) {\n    // Reset the selected index to 0 if the new items length is less than the selected index.\n    selectedIndex.value = 0;\n  }\n});\n\nfunction setContextValue(code) {\n  const safeCode = unref(code);\n  // This function is used to set the context value.\n  // The context value is used to set the value of the phone number field in the pre-chat form.\n  localValue.value = `${safeCode}${phoneNumber.value}`;\n  context.node.input(localValue.value);\n}\n\nfunction onChange(e) {\n  phoneNumber.value = e.target.value;\n  // This function is used to set the context value when the user types in the phone number field.\n  setContextValue(activeDialCode.value);\n}\n\nfunction focusedOrActiveItem(className) {\n  // This function is used to get the focused or active item in the dropdown.\n  if (!showDropdown.value) return [];\n  return Array.from(\n    dropdownRef.value?.querySelectorAll(\n      `div.country-dropdown div.country-dropdown--item.${className}`\n    )\n  );\n}\n\nfunction scrollToFocusedOrActiveItem(item) {\n  // This function is used to scroll the dropdown to the focused or active item.\n  const focusedOrActiveItemLocal = item;\n  if (focusedOrActiveItemLocal.length > 0) {\n    const dropdown = dropdownRef.value;\n    const dropdownHeight = dropdown.clientHeight;\n    const itemTop = focusedOrActiveItemLocal[0]?.offsetTop;\n    const itemHeight = focusedOrActiveItemLocal[0]?.offsetHeight;\n    const scrollPosition = itemTop - dropdownHeight / 2 + itemHeight / 2;\n    dropdown.scrollTo({\n      top: scrollPosition,\n      behavior: 'auto',\n    });\n  }\n}\n\nfunction adjustScroll() {\n  nextTick(() => {\n    scrollToFocusedOrActiveItem(focusedOrActiveItem('focus'));\n  });\n}\n\nfunction adjustSelection(direction) {\n  if (!showDropdown.value) return;\n  const maxIndex = items.value.length - 1;\n  if (direction === 'up') {\n    selectedIndex.value =\n      selectedIndex.value <= 0 ? maxIndex : selectedIndex.value - 1;\n  } else if (direction === 'down') {\n    selectedIndex.value =\n      selectedIndex.value >= maxIndex ? 0 : selectedIndex.value + 1;\n  }\n  adjustScroll();\n}\n\nfunction moveSelectionUp() {\n  adjustSelection('up');\n}\nfunction moveSelectionDown() {\n  adjustSelection('down');\n}\n\nfunction closeDropdown() {\n  selectedIndex.value = -1;\n  showDropdown.value = false;\n}\n\nfunction onSelectCountry(country) {\n  activeCountryCode.value = country.id;\n  searchCountry.value = '';\n  activeDialCode.value = country.dial_code ? country.dial_code : '';\n  setContextValue(country.dial_code);\n  closeDropdown();\n}\n\nfunction toggleCountryDropdown() {\n  showDropdown.value = !showDropdown.value;\n  selectedIndex.value = -1;\n  if (showDropdown.value) {\n    nextTick(() => {\n      searchbarRef.value.focus();\n      // This is used to scroll the dropdown to the active item.\n      scrollToFocusedOrActiveItem(focusedOrActiveItem('active'));\n    });\n  }\n}\n\nfunction onSelect() {\n  if (!showDropdown.value || selectedIndex.value === -1) return;\n  onSelectCountry(items.value[selectedIndex.value]);\n}\n</script>\n\n<template>\n  <div class=\"relative mt-2 phone-input--wrap\">\n    <div\n      class=\"flex items-center justify-start outline-none phone-input rounded-lg box-border bg-n-background dark:bg-n-alpha-2 border-none outline outline-1 outline-offset-[-1px] text-sm w-full text-n-slate-12 focus-within:outline-n-brand focus-within:ring-1 focus-within:ring-n-brand\"\n      :class=\"{\n        'outline-n-ruby-8 dark:outline-n-ruby-8 hover:outline-n-ruby-9 dark:hover:outline-n-ruby-9':\n          hasErrorInPhoneInput,\n        'outline-n-weak': !hasErrorInPhoneInput,\n      }\"\n    >\n      <div\n        class=\"flex items-center justify-between h-[2.625rem] px-2 py-2 cursor-pointer bg-n-alpha-1 dark:bg-n-solid-1 ltr:rounded-bl-lg rtl:rounded-br-lg ltr:rounded-tl-lg rtl:rounded-tr-lg min-w-[3.6rem] w-[3.6rem]\"\n        @click=\"toggleCountryDropdown\"\n      >\n        <h5 v-if=\"activeCountry.emoji\" class=\"mb-0 text-xl\">\n          {{ activeCountry.emoji }}\n        </h5>\n        <FluentIcon v-else icon=\"globe\" class=\"fluent-icon\" size=\"20\" />\n        <FluentIcon icon=\"chevron-down\" class=\"fluent-icon\" size=\"12\" />\n      </div>\n      <span\n        v-if=\"activeDialCode\"\n        class=\"py-2 ltr:pl-2 rtl:pr-2 text-base text-n-slate-11\"\n      >\n        {{ activeDialCode }}\n      </span>\n      <input\n        :value=\"phoneNumber\"\n        type=\"phoneInput\"\n        class=\"w-full h-full !py-3 pl-2 pr-3 leading-tight rounded-r !outline-none focus:!ring-0 !bg-transparent dark:!bg-transparent\"\n        name=\"phoneNumber\"\n        :placeholder=\"placeholder\"\n        @input=\"onChange\"\n        @blur=\"context.blurHandler\"\n      />\n    </div>\n    <div\n      v-if=\"showDropdown\"\n      ref=\"dropdownRef\"\n      v-on-clickaway=\"closeDropdown\"\n      class=\"country-dropdown absolute bg-n-background text-n-slate-12 dark:bg-n-solid-3 z-10 h-48 px-0 pt-0 pb-1 pl-1 pr-1 overflow-y-auto rounded-lg shadow-lg top-12 w-full min-w-24 max-w-[14.8rem]\"\n      @keydown.up=\"moveSelectionUp\"\n      @keydown.down=\"moveSelectionDown\"\n      @keydown.enter=\"onSelect\"\n    >\n      <div\n        class=\"sticky top-0 bg-n-background text-n-slate-12 dark:bg-n-solid-3\"\n      >\n        <input\n          ref=\"searchbarRef\"\n          v-model=\"searchCountry\"\n          type=\"text\"\n          :placeholder=\"$t('PRE_CHAT_FORM.FIELDS.PHONE_NUMBER.DROPDOWN_SEARCH')\"\n          class=\"w-full h-8 !ring-0 px-3 py-2 mt-1 mb-1 text-sm rounded bg-n-alpha-black2\"\n        />\n      </div>\n      <div\n        v-for=\"(country, index) in items\"\n        :key=\"index\"\n        class=\"flex items-center h-8 px-2 py-2 rounded cursor-pointer country-dropdown--item text-n-slate-12 dark:hover:bg-n-solid-2 hover:bg-n-alpha-2\"\n        :class=\"[\n          country.id === activeCountryCode &&\n            'active bg-n-alpha-1 dark:bg-n-solid-1',\n          index === selectedIndex && 'focus dark:bg-n-solid-2 bg-n-alpha-2',\n        ]\"\n        @click=\"onSelectCountry(country)\"\n      >\n        <span v-if=\"country.emoji\" class=\"mr-2 text-xl\">{{\n          country.emoji\n        }}</span>\n        <span class=\"text-sm leading-5 truncate\">\n          {{ country.name }}\n        </span>\n        <span class=\"ml-2 text-xs\">{{ country.dial_code }}</span>\n      </div>\n      <div v-if=\"items.length === 0\">\n        <span\n          class=\"flex justify-center mt-4 text-sm text-center text-n-slate-11\"\n        >\n          {{ $t('PRE_CHAT_FORM.FIELDS.PHONE_NUMBER.DROPDOWN_EMPTY') }}\n        </span>\n      </div>\n    </div>\n  </div>\n</template>\n","<script>\nimport CustomButton from 'shared/components/Button.vue';\nimport Spinner from 'shared/components/Spinner.vue';\nimport { mapGetters } from 'vuex';\nimport { getContrastingTextColor } from '@chatwoot/utils';\nimport { isEmptyObject } from 'widget/helpers/utils';\nimport { getRegexp } from 'shared/helpers/Validators';\nimport { useMessageFormatter } from 'shared/composables/useMessageFormatter';\nimport routerMixin from 'widget/mixins/routerMixin';\nimport configMixin from 'widget/mixins/configMixin';\nimport { FormKit, createInput } from '@formkit/vue';\nimport PhoneInput from 'widget/components/Form/PhoneInput.vue';\n\nexport default {\n  components: {\n    CustomButton,\n    Spinner,\n    FormKit,\n  },\n  mixins: [routerMixin, configMixin],\n  props: {\n    options: {\n      type: Object,\n      default: () => {},\n    },\n  },\n  emits: ['submitPreChat'],\n  setup() {\n    const phoneInput = createInput(PhoneInput, {\n      props: ['hasErrorInPhoneInput'],\n    });\n    const { formatMessage } = useMessageFormatter();\n\n    return { formatMessage, phoneInput };\n  },\n  data() {\n    return {\n      locale: this.$root.$i18n.locale,\n      hasErrorInPhoneInput: false,\n      message: '',\n      formValues: {},\n      labels: {\n        emailAddress: 'EMAIL_ADDRESS',\n        fullName: 'FULL_NAME',\n        phoneNumber: 'PHONE_NUMBER',\n      },\n    };\n  },\n  computed: {\n    ...mapGetters({\n      widgetColor: 'appConfig/getWidgetColor',\n      isCreating: 'conversation/getIsCreating',\n      isConversationRouting: 'appConfig/getIsUpdatingRoute',\n      activeCampaign: 'campaign/getActiveCampaign',\n      currentUser: 'contacts/getCurrentUser',\n    }),\n    isCreatingConversation() {\n      return this.isCreating || this.isConversationRouting;\n    },\n    textColor() {\n      return getContrastingTextColor(this.widgetColor);\n    },\n    hasActiveCampaign() {\n      return !isEmptyObject(this.activeCampaign);\n    },\n    shouldShowHeaderMessage() {\n      return (\n        this.hasActiveCampaign ||\n        (this.preChatFormEnabled && !!this.headerMessage)\n      );\n    },\n    headerMessage() {\n      if (this.preChatFormEnabled) {\n        return this.options.preChatMessage;\n      }\n      if (this.hasActiveCampaign) {\n        return this.$t('PRE_CHAT_FORM.CAMPAIGN_HEADER');\n      }\n      return '';\n    },\n    preChatFields() {\n      return this.preChatFormEnabled ? this.options.preChatFields : [];\n    },\n    filteredPreChatFields() {\n      const isUserEmailAvailable = this.currentUser.has_email;\n      const isUserPhoneNumberAvailable = this.currentUser.has_phone_number;\n      const isUserIdentifierAvailable = !!this.currentUser.identifier;\n\n      const isUserNameAvailable = !!(\n        isUserIdentifierAvailable ||\n        isUserEmailAvailable ||\n        isUserPhoneNumberAvailable\n      );\n      return this.preChatFields.filter(field => {\n        if (isUserEmailAvailable && field.name === 'emailAddress') {\n          return false;\n        }\n        if (isUserPhoneNumberAvailable && field.name === 'phoneNumber') {\n          return false;\n        }\n        if (isUserNameAvailable && field.name === 'fullName') {\n          return false;\n        }\n        return true;\n      });\n    },\n    enabledPreChatFields() {\n      return this.filteredPreChatFields\n        .filter(field => field.enabled)\n        .map(field => ({\n          ...field,\n          type:\n            field.name === 'phoneNumber'\n              ? this.phoneInput\n              : this.findFieldType(field.type),\n        }));\n    },\n    conversationCustomAttributes() {\n      let conversationAttributes = {};\n      this.enabledPreChatFields.forEach(field => {\n        if (field.field_type === 'conversation_attribute') {\n          conversationAttributes = {\n            ...conversationAttributes,\n            [field.name]: this.getValue(field),\n          };\n        }\n      });\n      return conversationAttributes;\n    },\n    contactCustomAttributes() {\n      let contactAttributes = {};\n      this.enabledPreChatFields.forEach(field => {\n        if (field.field_type === 'contact_attribute') {\n          contactAttributes = {\n            ...contactAttributes,\n            [field.name]: this.getValue(field),\n          };\n        }\n      });\n      return contactAttributes;\n    },\n  },\n  methods: {\n    labelClass(input) {\n      const { state } = input.context;\n      const hasErrors = state.invalid;\n      return !hasErrors ? 'text-n-slate-12' : 'text-n-ruby-10';\n    },\n    inputClass(input) {\n      const { state, family: classification, type } = input.context;\n      const hasErrors = state.invalid;\n      if (classification === 'box' && type === 'checkbox') {\n        return '';\n      }\n      if (type === 'phoneInput') {\n        this.hasErrorInPhoneInput = hasErrors;\n      }\n      if (!hasErrors) {\n        return `mt-1 rounded w-full py-2 px-3`;\n      }\n      return `mt-1 rounded w-full py-2 px-3 error`;\n    },\n    isContactFieldRequired(field) {\n      return this.preChatFields.find(option => option.name === field).required;\n    },\n    getLabel({ label }) {\n      return label;\n    },\n    getPlaceHolder({ placeholder }) {\n      return placeholder;\n    },\n    getValue({ name, type }) {\n      if (type === 'select') {\n        return this.enabledPreChatFields.find(option => option.name === name)\n          .values[this.formValues[name]];\n      }\n      return this.formValues[name] || null;\n    },\n    getValidation({ type, name, field_type, regex_pattern }) {\n      let regex = regex_pattern ? getRegexp(regex_pattern) : null;\n      const validations = {\n        emailAddress: 'email',\n        phoneNumber: ['startsWithPlus', 'isValidPhoneNumber'],\n        url: 'url',\n        date: 'date',\n        text: null,\n        select: null,\n        number: null,\n        checkbox: false,\n        contact_attribute: regex ? [['matches', regex]] : null,\n        conversation_attribute: regex ? [['matches', regex]] : null,\n      };\n      const validationKeys = Object.keys(validations);\n      const isRequired = this.isContactFieldRequired(name);\n      const validation = isRequired ? ['required'] : ['optional'];\n\n      if (\n        validationKeys.includes(name) ||\n        validationKeys.includes(type) ||\n        validationKeys.includes(field_type)\n      ) {\n        const validationType =\n          validations[type] || validations[name] || validations[field_type];\n        const allValidations = validationType\n          ? validation.concat(validationType)\n          : validation;\n        return allValidations.join('|');\n      }\n\n      return '';\n    },\n    findFieldType(type) {\n      if (type === 'link') {\n        return 'url';\n      }\n      if (type === 'list') {\n        return 'select';\n      }\n\n      return type;\n    },\n    getOptions(item) {\n      if (item.type === 'select') {\n        let values = {};\n        item.values.forEach((value, index) => {\n          values = {\n            ...values,\n            [index]: value,\n          };\n        });\n        return values;\n      }\n      return {};\n    },\n    onSubmit() {\n      const { emailAddress, fullName, phoneNumber, message } = this.formValues;\n      this.$emit('submitPreChat', {\n        fullName,\n        phoneNumber,\n        emailAddress,\n        message,\n        activeCampaignId: this.activeCampaign.id,\n        conversationCustomAttributes: this.conversationCustomAttributes,\n        contactCustomAttributes: this.contactCustomAttributes,\n      });\n    },\n  },\n};\n</script>\n\n<template>\n  <!-- hide the default submit button for now -->\n  <FormKit\n    v-model=\"formValues\"\n    type=\"form\"\n    form-class=\"flex flex-col flex-1 w-full p-6 overflow-y-auto\"\n    :incomplete-message=\"false\"\n    :submit-attrs=\"{\n      inputClass: 'hidden',\n      wrapperClass: 'hidden',\n    }\"\n    @submit=\"onSubmit\"\n  >\n    <div\n      v-if=\"shouldShowHeaderMessage\"\n      v-dompurify-html=\"formatMessage(headerMessage, false)\"\n      class=\"mb-4 text-base leading-5 text-n-slate-12 [&>p>.link]:text-n-blue-text [&>p>.link]:hover:underline\"\n    />\n    <!-- Why do the v-bind shenanigan? Because Formkit API is really bad.\n    If we just pass the options as is even with null or undefined or false,\n    it assumes we are trying to make a multicheckbox. This is the best we have for now -->\n    <FormKit\n      v-for=\"item in enabledPreChatFields\"\n      :key=\"item.name\"\n      :name=\"item.name\"\n      :type=\"item.type\"\n      :label=\"getLabel(item)\"\n      :placeholder=\"getPlaceHolder(item)\"\n      :validation=\"getValidation(item)\"\n      v-bind=\"\n        item.type === 'select'\n          ? {\n              options: getOptions(item),\n            }\n          : undefined\n      \"\n      :label-class=\"context => `text-sm font-medium ${labelClass(context)}`\"\n      :input-class=\"context => inputClass(context)\"\n      :validation-messages=\"{\n        startsWithPlus: $t(\n          'PRE_CHAT_FORM.FIELDS.PHONE_NUMBER.DIAL_CODE_VALID_ERROR'\n        ),\n        isValidPhoneNumber: $t('PRE_CHAT_FORM.FIELDS.PHONE_NUMBER.VALID_ERROR'),\n        email: $t('PRE_CHAT_FORM.FIELDS.EMAIL_ADDRESS.VALID_ERROR'),\n        required: $t('PRE_CHAT_FORM.REQUIRED'),\n        matches: item.regex_cue\n          ? item.regex_cue\n          : $t('PRE_CHAT_FORM.REGEX_ERROR'),\n      }\"\n      :has-error-in-phone-input=\"hasErrorInPhoneInput\"\n    />\n    <FormKit\n      v-if=\"!hasActiveCampaign\"\n      name=\"message\"\n      type=\"textarea\"\n      :label-class=\"context => `text-sm font-medium ${labelClass(context)}`\"\n      :input-class=\"context => inputClass(context)\"\n      :label=\"$t('PRE_CHAT_FORM.FIELDS.MESSAGE.LABEL')\"\n      :placeholder=\"$t('PRE_CHAT_FORM.FIELDS.MESSAGE.PLACEHOLDER')\"\n      validation=\"required\"\n      :validation-messages=\"{\n        required: $t('PRE_CHAT_FORM.FIELDS.MESSAGE.ERROR'),\n      }\"\n    />\n\n    <CustomButton\n      class=\"mt-3 mb-5 font-medium flex items-center justify-center gap-2\"\n      block\n      :bg-color=\"widgetColor\"\n      :text-color=\"textColor\"\n      :disabled=\"isCreatingConversation\"\n    >\n      <Spinner v-if=\"isCreatingConversation\" class=\"p-0\" />\n      {{ $t('START_CONVERSATION') }}\n    </CustomButton>\n  </FormKit>\n</template>\n\n<style lang=\"scss\">\n.formkit-outer {\n  @apply mt-2;\n\n  .formkit-inner {\n    input.error,\n    textarea.error,\n    select.error {\n      @apply outline-n-ruby-8 dark:outline-n-ruby-8 hover:outline-n-ruby-9 dark:hover:outline-n-ruby-9 focus:outline-n-ruby-9 dark:focus:outline-n-ruby-9;\n    }\n\n    input[type='checkbox'] {\n      @apply size-4 outline-none;\n    }\n  }\n}\n\n[data-invalid] .formkit-message {\n  @apply text-n-ruby-10 block text-xs font-normal my-0.5 w-full;\n}\n\n.formkit-outer[data-type='checkbox'] .formkit-wrapper {\n  @apply flex items-center gap-2 px-0.5;\n}\n\n.formkit-messages {\n  @apply list-none m-0 p-0;\n}\n</style>\n","<script>\nimport PreChatForm from '../components/PreChat/Form.vue';\nimport configMixin from '../mixins/configMixin';\nimport routerMixin from '../mixins/routerMixin';\nimport { isEmptyObject } from 'widget/helpers/utils';\nimport { ON_CONVERSATION_CREATED } from '../constants/widgetBusEvents';\nimport { emitter } from 'shared/helpers/mitt';\n\nexport default {\n  components: {\n    PreChatForm,\n  },\n  mixins: [configMixin, routerMixin],\n  mounted() {\n    // Register event listener for conversation creation\n    emitter.on(ON_CONVERSATION_CREATED, this.handleConversationCreated);\n  },\n  beforeUnmount() {\n    emitter.off(ON_CONVERSATION_CREATED, this.handleConversationCreated);\n  },\n  methods: {\n    handleConversationCreated() {\n      // Redirect to messages page after conversation is created\n      this.replaceRoute('messages');\n      // Only after successful navigation, reset the isUpdatingRoute UIflag in app/javascript/widget/router.js\n      // See issue: https://github.com/chatwoot/chatwoot/issues/10736\n    },\n\n    onSubmit({\n      fullName,\n      emailAddress,\n      message,\n      activeCampaignId,\n      phoneNumber,\n      contactCustomAttributes,\n      conversationCustomAttributes,\n    }) {\n      if (activeCampaignId) {\n        emitter.emit('execute-campaign', {\n          campaignId: activeCampaignId,\n          customAttributes: conversationCustomAttributes,\n        });\n        this.$store.dispatch('contacts/update', {\n          user: {\n            email: emailAddress,\n            name: fullName,\n            phone_number: phoneNumber,\n          },\n        });\n      } else {\n        this.$store.dispatch('conversation/createConversation', {\n          fullName: fullName,\n          emailAddress: emailAddress,\n          message: message,\n          phoneNumber: phoneNumber,\n          customAttributes: conversationCustomAttributes,\n        });\n      }\n      if (!isEmptyObject(contactCustomAttributes)) {\n        this.$store.dispatch(\n          'contacts/setCustomAttributes',\n          contactCustomAttributes\n        );\n      }\n    },\n  },\n};\n</script>\n\n<template>\n  <div class=\"flex flex-1 overflow-auto\">\n    <PreChatForm :options=\"preChatFormOptions\" @submit-pre-chat=\"onSubmit\" />\n  </div>\n</template>\n"],"names":["localValue","ref","__props","selectedIndex","showDropdown","searchCountry","activeCountryCode","getActiveCountryCode","activeDialCode","getActiveDialCode","phoneNumber","dropdownRef","useTemplateRef","searchbarRef","placeholder","computed","_b","_a","hasErrorInPhoneInput","dropdownFirstItemName","countries","countriesList","items","country","name","dial_code","id","search","activeCountry","watch","newItems","setContextValue","code","safeCode","unref","onChange","e","focusedOrActiveItem","className","scrollToFocusedOrActiveItem","item","focusedOrActiveItemLocal","dropdown","dropdownHeight","itemTop","itemHeight","scrollPosition","adjustScroll","nextTick","adjustSelection","direction","maxIndex","moveSelectionUp","moveSelectionDown","closeDropdown","onSelectCountry","toggleCountryDropdown","onSelect","_sfc_main","CustomButton","Spinner","FormKit","routerMixin","configMixin","phoneInput","createInput","PhoneInput","formatMessage","useMessageFormatter","mapGetters","getContrastingTextColor","isEmptyObject","isUserEmailAvailable","isUserPhoneNumberAvailable","isUserNameAvailable","field","conversationAttributes","contactAttributes","input","state","classification","type","hasErrors","option","label","field_type","regex_pattern","regex","getRegexp","validations","validationKeys","validation","validationType","values","value","index","emailAddress","fullName","message","_createBlock","_component_FormKit","$data","_cache","$event","$options","_withCtx","_withDirectives","_openBlock","_createElementBlock","_hoisted_1","_directive_dompurify_html","$setup","_createCommentVNode","_Fragment","_renderList","_mergeProps","context","_ctx","_createVNode","_component_CustomButton","_component_Spinner","_createTextVNode","PreChatForm","emitter","ON_CONVERSATION_CREATED","activeCampaignId","contactCustomAttributes","conversationCustomAttributes","_component_PreChatForm"],"mappings":"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"}