var vr=function(r,t,n,a){var i=null,l=0;return function(){for(var f=this,h=arguments.length,d=new Array(h),p=0;p<h;p++)d[p]=arguments[p];var b=Date.now(),g=l===0;if(g&&n){l=b,r.apply(this,d);return}i!==null&&(clearTimeout(i),i=null);var S=b-l,E=a!==void 0&&S>=a;if(E){l=b,r.apply(this,d);return}i=setTimeout(function(){l=Date.now(),i=null,r.apply(f,d)},t)}};function Z(s,r,t,n,a,i,l){try{var f=s[i](l),h=f.value}catch(d){t(d);return}f.done?r(h):Promise.resolve(h).then(n,a)}function er(s){return function(){var r=this,t=arguments;return new Promise(function(n,a){var i=s.apply(r,t);function l(h){Z(i,n,a,l,f,"next",h)}function f(h){Z(i,n,a,l,f,"throw",h)}l(void 0)})}}function D(){return D=Object.assign||function(s){for(var r=1;r<arguments.length;r++){var t=arguments[r];for(var n in t)Object.prototype.hasOwnProperty.call(t,n)&&(s[n]=t[n])}return s},D.apply(this,arguments)}function nr(s,r){return r={exports:{}},s(r,r.exports),r.exports}var J=nr(function(s){var r=function(t){var n=Object.prototype,a=n.hasOwnProperty,i,l=typeof Symbol=="function"?Symbol:{},f=l.iterator||"@@iterator",h=l.asyncIterator||"@@asyncIterator",d=l.toStringTag||"@@toStringTag";function p(o,e,u){return Object.defineProperty(o,e,{value:u,enumerable:!0,configurable:!0,writable:!0}),o[e]}try{p({},"")}catch{p=function(e,u,v){return e[u]=v}}function b(o,e,u,v){var c=e&&e.prototype instanceof m?e:m,w=Object.create(c.prototype),T=new $(v||[]);return w._invoke=Y(o,u,T),w}t.wrap=b;function g(o,e,u){try{return{type:"normal",arg:o.call(e,u)}}catch(v){return{type:"throw",arg:v}}}var S="suspendedStart",E="suspendedYield",k="executing",O="completed",y={};function m(){}function I(){}function N(){}var G={};G[f]=function(){return this};var R=Object.getPrototypeOf,U=R&&R(R(W([])));U&&U!==n&&a.call(U,f)&&(G=U);var _=N.prototype=m.prototype=Object.create(G);I.prototype=_.constructor=N,N.constructor=I,I.displayName=p(N,d,"GeneratorFunction");function P(o){["next","throw","return"].forEach(function(e){p(o,e,function(u){return this._invoke(e,u)})})}t.isGeneratorFunction=function(o){var e=typeof o=="function"&&o.constructor;return e?e===I||(e.displayName||e.name)==="GeneratorFunction":!1},t.mark=function(o){return Object.setPrototypeOf?Object.setPrototypeOf(o,N):(o.__proto__=N,p(o,d,"GeneratorFunction")),o.prototype=Object.create(_),o},t.awrap=function(o){return{__await:o}};function j(o,e){function u(w,T,L,C){var M=g(o[w],o,T);if(M.type==="throw")C(M.arg);else{var q=M.arg,V=q.value;return V&&typeof V=="object"&&a.call(V,"__await")?e.resolve(V.__await).then(function(F){u("next",F,L,C)},function(F){u("throw",F,L,C)}):e.resolve(V).then(function(F){q.value=F,L(q)},function(F){return u("throw",F,L,C)})}}var v;function c(w,T){function L(){return new e(function(C,M){u(w,T,C,M)})}return v=v?v.then(L,L):L()}this._invoke=c}P(j.prototype),j.prototype[h]=function(){return this},t.AsyncIterator=j,t.async=function(o,e,u,v,c){c===void 0&&(c=Promise);var w=new j(b(o,e,u,v),c);return t.isGeneratorFunction(e)?w:w.next().then(function(T){return T.done?T.value:w.next()})};function Y(o,e,u){var v=S;return function(w,T){if(v===k)throw new Error("Generator is already running");if(v===O){if(w==="throw")throw T;return Q()}for(u.method=w,u.arg=T;;){var L=u.delegate;if(L){var C=A(L,u);if(C){if(C===y)continue;return C}}if(u.method==="next")u.sent=u._sent=u.arg;else if(u.method==="throw"){if(v===S)throw v=O,u.arg;u.dispatchException(u.arg)}else u.method==="return"&&u.abrupt("return",u.arg);v=k;var M=g(o,e,u);if(M.type==="normal"){if(v=u.done?O:E,M.arg===y)continue;return{value:M.arg,done:u.done}}else M.type==="throw"&&(v=O,u.method="throw",u.arg=M.arg)}}}function A(o,e){var u=o.iterator[e.method];if(u===i){if(e.delegate=null,e.method==="throw"){if(o.iterator.return&&(e.method="return",e.arg=i,A(o,e),e.method==="throw"))return y;e.method="throw",e.arg=new TypeError("The iterator does not provide a 'throw' method")}return y}var v=g(u,o.iterator,e.arg);if(v.type==="throw")return e.method="throw",e.arg=v.arg,e.delegate=null,y;var c=v.arg;if(!c)return e.method="throw",e.arg=new TypeError("iterator result is not an object"),e.delegate=null,y;if(c.done)e[o.resultName]=c.value,e.next=o.nextLoc,e.method!=="return"&&(e.method="next",e.arg=i);else return c;return e.delegate=null,y}P(_),p(_,d,"Generator"),_[f]=function(){return this},_.toString=function(){return"[object Generator]"};function tr(o){var e={tryLoc:o[0]};1 in o&&(e.catchLoc=o[1]),2 in o&&(e.finallyLoc=o[2],e.afterLoc=o[3]),this.tryEntries.push(e)}function B(o){var e=o.completion||{};e.type="normal",delete e.arg,o.completion=e}function $(o){this.tryEntries=[{tryLoc:"root"}],o.forEach(tr,this),this.reset(!0)}t.keys=function(o){var e=[];for(var u in o)e.push(u);return e.reverse(),function v(){for(;e.length;){var c=e.pop();if(c in o)return v.value=c,v.done=!1,v}return v.done=!0,v}};function W(o){if(o){var e=o[f];if(e)return e.call(o);if(typeof o.next=="function")return o;if(!isNaN(o.length)){var u=-1,v=function c(){for(;++u<o.length;)if(a.call(o,u))return c.value=o[u],c.done=!1,c;return c.value=i,c.done=!0,c};return v.next=v}}return{next:Q}}t.values=W;function Q(){return{value:i,done:!0}}return $.prototype={constructor:$,reset:function(o){if(this.prev=0,this.next=0,this.sent=this._sent=i,this.done=!1,this.delegate=null,this.method="next",this.arg=i,this.tryEntries.forEach(B),!o)for(var e in this)e.charAt(0)==="t"&&a.call(this,e)&&!isNaN(+e.slice(1))&&(this[e]=i)},stop:function(){this.done=!0;var o=this.tryEntries[0],e=o.completion;if(e.type==="throw")throw e.arg;return this.rval},dispatchException:function(o){if(this.done)throw o;var e=this;function u(C,M){return w.type="throw",w.arg=o,e.next=C,M&&(e.method="next",e.arg=i),!!M}for(var v=this.tryEntries.length-1;v>=0;--v){var c=this.tryEntries[v],w=c.completion;if(c.tryLoc==="root")return u("end");if(c.tryLoc<=this.prev){var T=a.call(c,"catchLoc"),L=a.call(c,"finallyLoc");if(T&&L){if(this.prev<c.catchLoc)return u(c.catchLoc,!0);if(this.prev<c.finallyLoc)return u(c.finallyLoc)}else if(T){if(this.prev<c.catchLoc)return u(c.catchLoc,!0)}else if(L){if(this.prev<c.finallyLoc)return u(c.finallyLoc)}else throw new Error("try statement without catch or finally")}}},abrupt:function(o,e){for(var u=this.tryEntries.length-1;u>=0;--u){var v=this.tryEntries[u];if(v.tryLoc<=this.prev&&a.call(v,"finallyLoc")&&this.prev<v.finallyLoc){var c=v;break}}c&&(o==="break"||o==="continue")&&c.tryLoc<=e&&e<=c.finallyLoc&&(c=null);var w=c?c.completion:{};return w.type=o,w.arg=e,c?(this.method="next",this.next=c.finallyLoc,y):this.complete(w)},complete:function(o,e){if(o.type==="throw")throw o.arg;return o.type==="break"||o.type==="continue"?this.next=o.arg:o.type==="return"?(this.rval=this.arg=o.arg,this.method="return",this.next="end"):o.type==="normal"&&e&&(this.next=e),y},finish:function(o){for(var e=this.tryEntries.length-1;e>=0;--e){var u=this.tryEntries[e];if(u.finallyLoc===o)return this.complete(u.completion,u.afterLoc),B(u),y}},catch:function(o){for(var e=this.tryEntries.length-1;e>=0;--e){var u=this.tryEntries[e];if(u.tryLoc===o){var v=u.completion;if(v.type==="throw"){var c=v.arg;B(u)}return c}}throw new Error("illegal catch attempt")},delegateYield:function(o,e,u){return this.delegate={iterator:W(o),resultName:e,nextLoc:u},this.method==="next"&&(this.arg=i),y}},t}(s.exports);try{regeneratorRuntime=r}catch{Function("r","regeneratorRuntime = r")(r)}}),hr=function(r){var t=r.replace("#",""),n=parseInt(t.slice(0,2),16),a=parseInt(t.slice(2,4),16),i=parseInt(t.slice(4,6),16);return n*.299+a*.587+i*.114>186?"#000000":"#FFFFFF"},pr=function(r){var t="";if(r>=60&&r<3600){var n=Math.floor(r/60);t=n+" Min";var a=n===60?0:Math.floor(r%60);return t+(a>0?" "+a+" Sec":"")}if(r>=3600&&r<86400){var i=Math.floor(r/3600);t=i+" Hr";var l=r%3600<60||i===24?0:Math.floor(r%3600/60);return t+(l>0?" "+l+" Min":"")}if(r>=86400){var f=Math.floor(r/86400);t=f+" Day";var h=r%86400<3600||f>=364?0:Math.floor(r%86400/3600);return t+(h>0?" "+h+" Hr":"")}return Math.floor(r)+" Sec"},dr=function(r,t,n){r===void 0&&(r=""),t===void 0&&(t=1024),n===void 0&&(n=!1);var a=r;return r.length>t&&(a=r.substring(0,t)),n&&(a=a+"..."),a},mr=function(r,t){return r===null||r===0?{time:"",unit:""}:r<3600?{time:Number((r/60).toFixed(1)),unit:t.minute}:r<86400?{time:Number((r/3600).toFixed(1)),unit:t.hour}:{time:Number((r/86400).toFixed(1)),unit:t.day}},gr=function(r,t,n){var a,i;t===void 0&&(t=26),n===void 0&&(n="â€¦");var l=(a=(i=r==null?void 0:r.filename)!=null?i:r==null?void 0:r.name)!=null?a:"Untitled",f=l.lastIndexOf(".");if(f===-1)return l;var h=[l.slice(0,f),l.slice(f)],d=h[0],p=h[1];return d.length<=t?l:""+d.slice(0,t)+n+p},yr=function(r){var t=r.trim();if(!t)return{firstName:"",lastName:""};var n=t.split(/\s+/);if(n.length===1)return{firstName:n[0],lastName:""};var a=n.pop()||"",i=n.join(" ");return{firstName:i,lastName:a}},wr=function(){var s=er(J.mark(function r(t){var n,a,i,l,f,h,d,p,b,g,S,E,k,O;return J.wrap(function(m){for(;;)switch(m.prev=m.next){case 0:if(n=t.url,a=t.type,i=t.extension,l=i===void 0?null:i,!(!n||!a)){m.next=3;break}throw new Error("Invalid download parameters");case 3:return m.prev=3,m.next=6,fetch(n,{cache:"no-store"});case 6:if(h=m.sent,h.ok){m.next=9;break}throw new Error("Download failed: "+h.status);case 9:return m.next=11,h.blob();case 11:d=m.sent,p=h.headers.get("content-type"),b=l||(p?p.split("/")[1]:a),g=h.headers.get("content-disposition"),S=g==null?void 0:g.match(/filename="(.*?)"/),E=(f=S==null?void 0:S[1])!=null?f:"attachment_"+Date.now()+"."+b,k=URL.createObjectURL(d),O=Object.assign(document.createElement("a"),{href:k,download:E,style:"display: none"}),document.body.append(O),O.click(),O.remove(),URL.revokeObjectURL(k),m.next=28;break;case 25:throw m.prev=25,m.t0=m.catch(3),m.t0 instanceof Error?m.t0:new Error("Download failed");case 28:case"end":return m.stop()}},r,null,[[3,25]])}));return function(t){return s.apply(this,arguments)}}(),br=function(r){var t={name:"Unknown File",type:"",base:"Unknown File"};if(!r||typeof r!="string")return t;try{var n=r.split(/[?#]/)[0].replace(/\\/g,"/"),a=n.split("/").pop();if(!a)return t;var i=decodeURIComponent(a);if(i.startsWith(".")&&!i.includes(".",1))return{name:i,type:"",base:i};var l=i.lastIndexOf(".");if(l===-1||l===0)return{name:i,type:"",base:i};var f=i.slice(0,l),h=i.slice(l+1).toLowerCase();return{name:i,type:h,base:f}}catch(d){return console.error("Error processing file info:",d),t}},X;(function(s){s[s.INCOMING=0]="INCOMING",s[s.OUTGOING=1]="OUTGOING",s[s.ACTIVITY=2]="ACTIVITY",s[s.TEMPLATE=3]="TEMPLATE"})(X||(X={}));function Tr(s,r,t,n){var a,i=[],l=[],f=[];if(!s)return{to:i,cc:l,bcc:f};var h=s.message_type,d=h===X.INCOMING,p={};if(d){var b=s.content_attributes,g=b.email;p={cc:(g==null?void 0:g.cc)||[],bcc:(g==null?void 0:g.bcc)||[],from:(g==null?void 0:g.from)||[],to:[]}}else{var S=s.content_attributes,E=S??{},k=E.cc_emails,O=k===void 0?[]:k,y=E.bcc_emails,m=y===void 0?[]:y,I=E.to_emails,N=I===void 0?[]:I;p={cc:O,bcc:m,to:N,from:[]}}var G=!1;if(G=d&&((a=p.from)!=null?a:[]).includes(r),d){var R,U;(R=i).push.apply(R,(U=p.from)!=null?U:[])}else{var _,P;(_=i).push.apply(_,(P=p.to)!=null?P:[r])}if(l=p.cc?[].concat(p.cc):[],Array.isArray(p.to)){var j;(j=l).push.apply(j,p.to)}!G&&d&&l.push(r),f=(p.bcc||[]).filter(function(A){return A!==r});var Y=/^reply\+([0-9a-f]{8}-[0-9a-f]{4}-[0-9a-f]{4}-[0-9a-f]{4}-[0-9a-f]{12})@[a-zA-Z0-9.-]+\.[a-zA-Z]{2,}$/i;return l=l.filter(function(A){return!(A===r&&G||A===t||A===n||Y.test(A))}),f=f.filter(function(A){return!(A===t||A===n||Y.test(A))}),i=Array.from(new Set(i)),l=Array.from(new Set(l)),f=Array.from(new Set(f)),{to:i,cc:l,bcc:f}}function Lr(s){try{var r=String(s).toLowerCase();return!!JSON.parse(r)}catch{return!1}}function ar(s){return s.slice().sort(function(r,t){return r-t})}function ir(s,r,t){return t<s?s:t>r?r:t}function or(s,r){var t=ir(0,1,r),n=(s.length-1)*t,a=Math.floor(n),i=n-a;return s[a+1]!==void 0?s[a]+i*(s[a+1]-s[a]):s[a]}var Mr=function(r,t){var n=ar(r);return t.map(function(a){return or(n,a)})},Sr=function(r,t,n){var a=n.left+n.width/2,i=n.top+n.height/2;return{relativeX:r-a,relativeY:t-i}},Or=function(r,t,n){var a=n*Math.PI/180,i=Math.cos(-a),l=Math.sin(-a);return{rotatedX:r*i-t*l,rotatedY:r*l+t*i}},Ar=function(r,t,n,a){return{x:Math.max(0,Math.min(100,50+r/(n/2)*50)),y:Math.max(0,Math.min(100,50+t/(a/2)*50))}},rr=/{{(.*?)}}/g,ur=function(r){return r.replace(/```(?:.|\n)+?```/g,"")},z=function(r){return r?r.split(" ").map(function(t){return t?t.charAt(0).toUpperCase()+t.slice(1):""}).join(" "):""},K=function(r){var t=r.user,n=t!=null&&t.name?t.name.split(" ").shift():"";return z(n)},x=function(r){var t=r.user;if(t&&t.name){var n=t.name.split(" ").length>1?t.name.split(" ").pop():"";return z(n)}return""},Er=function(r){var t,n=r.conversation,a=r.contact,i=n.meta,l=i.assignee,f=i.sender,h=n.id,d=n.custom_attributes,p=d===void 0?{}:d,b=a||{},g=b.custom_attributes,S={"contact.name":z((f==null?void 0:f.name)||""),"contact.first_name":K({user:f}),"contact.last_name":x({user:f}),"contact.email":f==null?void 0:f.email,"contact.phone":f==null?void 0:f.phone_number,"contact.id":f==null?void 0:f.id,"conversation.id":h,"agent.name":z((l==null?void 0:l.name)||""),"agent.first_name":K({user:l}),"agent.last_name":x({user:l}),"agent.email":(t=l==null?void 0:l.email)!=null?t:""},E=Object.entries(p??{}).reduce(function(y,m){var I=m[0],N=m[1];return y["conversation.custom_attribute."+I]=N,y},{}),k=Object.entries(g??{}).reduce(function(y,m){var I=m[0],N=m[1];return y["contact.custom_attribute."+I]=N,y},{}),O=D({},S,E,k);return O},Nr=function(r){var t=r.message,n=r.variables;return t==null?void 0:t.replace(rr,function(a,i){return n[i.trim()]?n[i.trim().toLowerCase()]:""})},Cr=function(r){var t=r.message,n=r.variables,a=ur(t),i=a.match(rr);return i?i.map(function(l){return l.replace("{{","").replace("}}","").trim()}).filter(function(l){return n[l]===void 0}):[]},kr=function(r,t,n){var a=null,i=function(){a||r(),f()},l=function(){a&&(clearTimeout(a),a=null,t())},f=function(){a&&clearTimeout(a),a=setTimeout(function(){l()},n)};return{start:i,stop:l}},H=function(r,t){if(t===null)return null;var n=Math.floor(Date.now()/1e3);return r+t-n},sr=function(r){return r.sort(function(t,n){return Math.abs(t.threshold)-Math.abs(n.threshold)}),r[0]},lr=function(r){var t={y:31536e3,mo:2592e3,d:86400,h:3600,m:60};if(r<60)return"1m";var n=[];return Object.keys(t).forEach(function(a){var i=Math.floor(r/t[a]);r<60&&n.length>0||n.length!==2&&i>0&&(n.push(i+a),r-=i*t[a])}),n.join(" ")},fr=function(r,t,n){var a=t.sla_first_response_time_threshold,i=t.sla_next_response_time_threshold,l=t.sla_resolution_time_threshold,f=t.created_at,h=n.first_reply_created_at,d=n.waiting_since,p=n.status,b={FRT:{threshold:H(f,a),condition:a!==null&&(!h||h===0)},NRT:{threshold:H(d,i),condition:i!==null&&!!h&&!!d},RT:{threshold:H(f,l),condition:p==="open"&&l!==null}},g=b[r];return g?D({},g,{type:r}):null},cr=function(r,t){var n=["FRT","NRT","RT"];return n.map(function(a){return fr(a,r,t)}).filter(function(a){return!!a&&a.condition}).map(function(a){return D({},a,{icon:a.threshold<=0?"flame":"alarm",isSlaMissed:a.threshold<=0})})},Ir=function(r){var t=r.appliedSla,n=r.chat;if(!t||!n)return{type:"",threshold:"",icon:"",isSlaMissed:!1};var a=cr(t,n),i=sr(a);return i?{type:i==null?void 0:i.type,threshold:lr(i.threshold<=0?-i.threshold:i.threshold),icon:i.icon,isSlaMissed:i.isSlaMissed}:{type:"",threshold:"",icon:"",isSlaMissed:!1}};export{Mr as a,mr as b,kr as c,vr as d,Ir as e,pr as f,hr as g,Tr as h,Cr as i,Er as j,Sr as k,Or as l,wr as m,Ar as n,br as o,gr as p,Lr as q,Nr as r,yr as s,dr as t};
