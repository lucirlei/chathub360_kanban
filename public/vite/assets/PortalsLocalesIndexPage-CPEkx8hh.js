import{c as v,I as H,a as g,o as p,l as S,s as d,p as D,g as b,t as O,i as U,e as h,H as C,F as j,j as M,r as P}from"./_plugin-vue_export-helper-IoQslFd3.js";import{u as $}from"./Validators-DkQimdV0.js";import{u as N,b as G,c as I}from"./useBranding-CD_QbCIP.js";import{q as B,L as q,c as V,r as F,u as z,l as w,w as X,s as K}from"./dashboard-B8DxvGhj.js";import{_ as W}from"./HelpCenterLayout-Cxv-mUuH.js";import{_ as k,a as J}from"./exports-Db5CWii1.js";import{a as T,u as R}from"./index-DyRF4TQi.js";import{an as x}from"./DashboardIcon-D9a-qnXf.js";import"./index-DN3rM4CW.js";import"./index-BtuGy7By.js";import"./_commonjsHelpers-BosuxZz1.js";import"./index-DJvhFcF9.js";import"./typing-B_xc7lBt.js";import"./vue-dompurify-html-CEAHYyWB.js";import"./utils.esm-dig4nDxm.js";import"./useKeyboardNavigableList-DBoi-hid.js";import"./helper-q29O9VCT.js";import"./Icon-Dg_4WYMY.js";import"./globals-DPjCpsAT.js";import"./Avatar-CS4GuSbz.js";import"./module-CEpankYo.js";import"./BarChart-CqJKiiio.js";import"./constants-lVAyZKq6.js";import"./IframeLoader-BKISZm2C.js";import"./js.cookie-Cz0CWeBA.js";const Q={class:"flex justify-between gap-2"},Y={class:"flex items-center justify-start gap-2"},Z={class:"text-sm font-medium text-n-slate-12 line-clamp-1"},ee={key:0,class:"bg-n-alpha-2 h-6 inline-flex items-center justify-center rounded-md text-xs border-px border-transparent text-n-blue-text px-2 py-0.5"},te={class:"flex items-center justify-end gap-4"},ae={class:"flex items-center gap-4"},oe={class:"text-sm text-n-slate-11 whitespace-nowrap"},se={class:"text-sm text-n-slate-11 whitespace-nowrap"},le={class:"relative group"},ne={__name:"LocaleCard",props:{locale:{type:String,required:!0},isDefault:{type:Boolean,required:!0},localeCode:{type:String,required:!0},articleCount:{type:Number,required:!0},categoryCount:{type:Number,required:!0}},emits:["action"],setup(s,{emit:n}){const i=s,l=n,{t:_}=N(),[L,e]=B(),A=v(()=>q.map(r=>({...r,label:_(r.label),disabled:i.isDefault}))),E=({action:r,value:m})=>{l("action",{action:r,value:m}),e(!1)};return(r,m)=>{const y=H("on-clickaway");return p(),g(F,null,{default:S(()=>[d("div",Q,[d("div",Y,[d("span",Z,O(s.locale)+" ("+O(s.localeCode)+") ",1),s.isDefault?(p(),D("span",ee,O(r.$t("HELP_CENTER.LOCALES_PAGE.LOCALE_CARD.DEFAULT")),1)):b("",!0)]),d("div",te,[d("div",ae,[d("span",oe,O(r.$t("HELP_CENTER.LOCALES_PAGE.LOCALE_CARD.ARTICLES_COUNT",s.articleCount)),1),m[1]||(m[1]=d("div",{class:"w-px h-3 bg-n-weak"},null,-1)),d("span",se,O(r.$t("HELP_CENTER.LOCALES_PAGE.LOCALE_CARD.CATEGORIES_COUNT",s.categoryCount)),1)]),U((p(),D("div",le,[h(k,{icon:"i-lucide-ellipsis-vertical",color:"slate",size:"xs",class:"rounded-md group-hover:bg-n-alpha-2",onClick:m[0]||(m[0]=c=>C(e)())}),C(L)?(p(),g(V,{key:0,"menu-items":A.value,class:"ltr:right-0 rtl:left-0 mt-1 xl:ltr:left-0 xl:rtl:right-0 top-full z-60 min-w-[150px]",onAction:E},null,8,["menu-items"])):b("",!0)])),[[y,()=>C(e)(!1)]])])])]),_:1})}}},ce={role:"list",class:"w-full h-full space-y-4"},re={__name:"LocaleList",props:{locales:{type:Array,required:!0},portal:{type:Object,required:!0}},setup(s){const n=s,i=G(),{t:l}=N(),_=$(),{uiSettings:L,updateUISettings:e}=z(),A=t=>{var a,o;return((o=(a=n.portal)==null?void 0:a.meta)==null?void 0:o.default_locale)===t},E=async({newAllowedLocales:t,defaultLocale:a,messageKey:o})=>{let u="";try{await i.dispatch("portals/update",{portalSlug:n.portal.slug,config:{default_locale:a,allowed_locales:t}}),u=l(`HELP_CENTER.PORTAL.${o}.API.SUCCESS_MESSAGE`)}catch(f){u=(f==null?void 0:f.message)||l(`HELP_CENTER.PORTAL.${o}.API.ERROR_MESSAGE`)}finally{R(u)}},r=({localeCode:t})=>{const a=n.locales.map(o=>o.code);E({newAllowedLocales:a,defaultLocale:t,messageKey:"CHANGE_DEFAULT_LOCALE"}),T(x.SET_DEFAULT_LOCALE,{newLocale:t,from:_.name})},m=async t=>{const{last_active_locale_code:a}=L.value||{},o=n.portal.meta.default_locale;t===a&&await e({last_active_locale_code:o})},y=async({localeCode:t})=>{const a=n.locales.filter(u=>u.code!==t).map(u=>u.code),o=n.portal.meta.default_locale;await E({newAllowedLocales:a,defaultLocale:o,messageKey:"DELETE_LOCALE"}),await m(t),T(x.DELETE_LOCALE,{deletedLocale:t,from:_.name})},c=({action:t},a)=>{t==="change-default"?r({localeCode:a}):t==="delete"&&y({localeCode:a})};return(t,a)=>(p(),D("ul",ce,[(p(!0),D(j,null,M(s.locales,(o,u)=>(p(),g(ne,{key:u,locale:o.name,"is-default":A(o.code),"locale-code":o.code,"article-count":o.articlesCount||0,"category-count":o.categoriesCount||0,onAction:f=>c(f,o.code)},null,8,["locale","is-default","locale-code","article-count","category-count","onAction"]))),128))]))}},ie={class:"flex flex-col gap-6"},ue={__name:"AddLocaleDialog",props:{portal:{type:Object,default:()=>({})}},setup(s,{expose:n}){const i=s,{t:l}=N(),_=G(),L=$(),e=P(null),A=P(!1),E=P(""),r=v(()=>{var t;const{allowed_locales:c=[]}=((t=i.portal)==null?void 0:t.config)||{};return c.map(a=>a.code)}),m=v(()=>Object.keys(w).map(c=>({value:c,label:`${w[c]} (${c})`})).filter(c=>!r.value.includes(c.value))),y=async()=>{var t,a,o,u;if(!E.value)return;A.value=!0;const c=[...r.value,E.value];try{await _.dispatch("portals/update",{portalSlug:(t=i.portal)==null?void 0:t.slug,config:{allowed_locales:c,default_locale:(o=(a=i.portal)==null?void 0:a.meta)==null?void 0:o.default_locale}}),T(x.CREATE_LOCALE,{localeAdded:E.value,totalLocales:c.length,from:L.name}),(u=e.value)==null||u.close(),R(l("HELP_CENTER.LOCALES_PAGE.ADD_LOCALE_DIALOG.API.SUCCESS_MESSAGE"))}catch(f){R((f==null?void 0:f.message)||l("HELP_CENTER.LOCALES_PAGE.ADD_LOCALE_DIALOG.API.ERROR_MESSAGE"))}finally{A.value=!1}};return n({dialogRef:e}),(c,t)=>(p(),g(K,{ref_key:"dialogRef",ref:e,type:"edit",title:C(l)("HELP_CENTER.LOCALES_PAGE.ADD_LOCALE_DIALOG.TITLE"),description:C(l)("HELP_CENTER.LOCALES_PAGE.ADD_LOCALE_DIALOG.DESCRIPTION"),onConfirm:y},{default:S(()=>[d("div",ie,[h(X,{modelValue:E.value,"onUpdate:modelValue":t[0]||(t[0]=a=>E.value=a),options:m.value,placeholder:C(l)("HELP_CENTER.LOCALES_PAGE.ADD_LOCALE_DIALOG.COMBOBOX.PLACEHOLDER"),class:"[&>div>button:not(.focused)]:!outline-n-slate-5 [&>div>button:not(.focused)]:dark:!outline-n-slate-5"},null,8,["modelValue","options","placeholder"])])]),_:1},8,["title","description"]))}},de={class:"flex items-center justify-between"},pe={class:"flex items-center gap-4"},_e={class:"text-sm font-medium text-n-slate-12"},Le={key:0,class:"flex items-center justify-center py-10 text-n-slate-11"},Ee={__name:"LocalesPage",props:{locales:{type:Array,required:!0},portal:{type:Object,default:()=>({})}},setup(s){const n=s,i=P(null),l=I("portals/isSwitchingPortal"),_=()=>{i.value.dialogRef.open()},L=v(()=>{var e;return(e=n.locales)==null?void 0:e.length});return(e,A)=>(p(),g(W,{"show-pagination-footer":!1},{"header-actions":S(()=>[d("div",de,[d("div",pe,[d("span",_e,O(e.$t("HELP_CENTER.LOCALES_PAGE.LOCALES_COUNT",L.value)),1)]),h(k,{label:e.$t("HELP_CENTER.LOCALES_PAGE.NEW_LOCALE_BUTTON_TEXT"),icon:"i-lucide-plus",size:"sm",onClick:_},null,8,["label"])])]),content:S(()=>[C(l)?(p(),D("div",Le,[h(J)])):(p(),g(re,{key:1,locales:s.locales,portal:s.portal},null,8,["locales","portal"]))]),default:S(()=>[h(ue,{ref_key:"addLocaleDialogRef",ref:i,portal:s.portal},null,8,["portal"])]),_:1}))}},Me={__name:"PortalsLocalesIndexPage",setup(s){const n=$(),i=I("portals/portalBySlug"),l=v(()=>i.value(n.params.portalSlug)),_=v(()=>{if(!l.value)return[];const{allowed_locales:L}=l.value.config;return L.map(e=>({id:e==null?void 0:e.code,name:w[e==null?void 0:e.code],code:e==null?void 0:e.code,articlesCount:(e==null?void 0:e.articles_count)||0,categoriesCount:(e==null?void 0:e.categories_count)||0}))});return(L,e)=>(p(),g(Ee,{locales:_.value,portal:l.value},null,8,["locales","portal"]))}};export{Me as default};
//# sourceMappingURL=PortalsLocalesIndexPage-CPEkx8hh.js.map
