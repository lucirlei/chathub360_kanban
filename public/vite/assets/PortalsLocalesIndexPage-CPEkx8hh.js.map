{"version":3,"file":"PortalsLocalesIndexPage-CPEkx8hh.js","sources":["../../../app/javascript/dashboard/components-next/HelpCenter/LocaleCard/LocaleCard.vue","../../../app/javascript/dashboard/components-next/HelpCenter/Pages/LocalePage/LocaleList.vue","../../../app/javascript/dashboard/components-next/HelpCenter/Pages/LocalePage/AddLocaleDialog.vue","../../../app/javascript/dashboard/components-next/HelpCenter/Pages/LocalePage/LocalesPage.vue","../../../app/javascript/dashboard/routes/dashboard/helpcenter/pages/PortalsLocalesIndexPage.vue"],"sourcesContent":["<script setup>\nimport { computed } from 'vue';\nimport { useI18n } from 'vue-i18n';\nimport { useToggle } from '@vueuse/core';\nimport { LOCALE_MENU_ITEMS } from 'dashboard/helper/portalHelper';\n\nimport CardLayout from 'dashboard/components-next/CardLayout.vue';\nimport Button from 'dashboard/components-next/button/Button.vue';\nimport DropdownMenu from 'dashboard/components-next/dropdown-menu/DropdownMenu.vue';\n\nconst props = defineProps({\n  locale: {\n    type: String,\n    required: true,\n  },\n  isDefault: {\n    type: Boolean,\n    required: true,\n  },\n  localeCode: {\n    type: String,\n    required: true,\n  },\n  articleCount: {\n    type: Number,\n    required: true,\n  },\n  categoryCount: {\n    type: Number,\n    required: true,\n  },\n});\n\nconst emit = defineEmits(['action']);\n\nconst { t } = useI18n();\n\nconst [showDropdownMenu, toggleDropdown] = useToggle();\n\nconst localeMenuItems = computed(() =>\n  LOCALE_MENU_ITEMS.map(item => ({\n    ...item,\n    label: t(item.label),\n    disabled: props.isDefault,\n  }))\n);\n\nconst handleAction = ({ action, value }) => {\n  emit('action', { action, value });\n  toggleDropdown(false);\n};\n</script>\n\n<template>\n  <CardLayout>\n    <div class=\"flex justify-between gap-2\">\n      <div class=\"flex items-center justify-start gap-2\">\n        <span class=\"text-sm font-medium text-n-slate-12 line-clamp-1\">\n          {{ locale }} ({{ localeCode }})\n        </span>\n        <span\n          v-if=\"isDefault\"\n          class=\"bg-n-alpha-2 h-6 inline-flex items-center justify-center rounded-md text-xs border-px border-transparent text-n-blue-text px-2 py-0.5\"\n        >\n          {{ $t('HELP_CENTER.LOCALES_PAGE.LOCALE_CARD.DEFAULT') }}\n        </span>\n      </div>\n      <div class=\"flex items-center justify-end gap-4\">\n        <div class=\"flex items-center gap-4\">\n          <span class=\"text-sm text-n-slate-11 whitespace-nowrap\">\n            {{\n              $t(\n                'HELP_CENTER.LOCALES_PAGE.LOCALE_CARD.ARTICLES_COUNT',\n                articleCount\n              )\n            }}\n          </span>\n          <div class=\"w-px h-3 bg-n-weak\" />\n          <span class=\"text-sm text-n-slate-11 whitespace-nowrap\">\n            {{\n              $t(\n                'HELP_CENTER.LOCALES_PAGE.LOCALE_CARD.CATEGORIES_COUNT',\n                categoryCount\n              )\n            }}\n          </span>\n        </div>\n        <div\n          v-on-clickaway=\"() => toggleDropdown(false)\"\n          class=\"relative group\"\n        >\n          <Button\n            icon=\"i-lucide-ellipsis-vertical\"\n            color=\"slate\"\n            size=\"xs\"\n            class=\"rounded-md group-hover:bg-n-alpha-2\"\n            @click=\"toggleDropdown()\"\n          />\n\n          <DropdownMenu\n            v-if=\"showDropdownMenu\"\n            :menu-items=\"localeMenuItems\"\n            class=\"ltr:right-0 rtl:left-0 mt-1 xl:ltr:left-0 xl:rtl:right-0 top-full z-60 min-w-[150px]\"\n            @action=\"handleAction\"\n          />\n        </div>\n      </div>\n    </div>\n  </CardLayout>\n</template>\n","<script setup>\nimport LocaleCard from 'dashboard/components-next/HelpCenter/LocaleCard/LocaleCard.vue';\nimport { useStore } from 'dashboard/composables/store';\nimport { useAlert, useTrack } from 'dashboard/composables';\nimport { useUISettings } from 'dashboard/composables/useUISettings';\nimport { useI18n } from 'vue-i18n';\nimport { useRoute } from 'vue-router';\nimport { PORTALS_EVENTS } from 'dashboard/helper/AnalyticsHelper/events';\n\nconst props = defineProps({\n  locales: {\n    type: Array,\n    required: true,\n  },\n  portal: {\n    type: Object,\n    required: true,\n  },\n});\n\nconst store = useStore();\nconst { t } = useI18n();\nconst route = useRoute();\nconst { uiSettings, updateUISettings } = useUISettings();\n\nconst isLocaleDefault = code => {\n  return props.portal?.meta?.default_locale === code;\n};\n\nconst updatePortalLocales = async ({\n  newAllowedLocales,\n  defaultLocale,\n  messageKey,\n}) => {\n  let alertMessage = '';\n  try {\n    await store.dispatch('portals/update', {\n      portalSlug: props.portal.slug,\n      config: {\n        default_locale: defaultLocale,\n        allowed_locales: newAllowedLocales,\n      },\n    });\n\n    alertMessage = t(`HELP_CENTER.PORTAL.${messageKey}.API.SUCCESS_MESSAGE`);\n  } catch (error) {\n    alertMessage =\n      error?.message || t(`HELP_CENTER.PORTAL.${messageKey}.API.ERROR_MESSAGE`);\n  } finally {\n    useAlert(alertMessage);\n  }\n};\n\nconst changeDefaultLocale = ({ localeCode }) => {\n  const newAllowedLocales = props.locales.map(locale => locale.code);\n  updatePortalLocales({\n    newAllowedLocales,\n    defaultLocale: localeCode,\n    messageKey: 'CHANGE_DEFAULT_LOCALE',\n  });\n  useTrack(PORTALS_EVENTS.SET_DEFAULT_LOCALE, {\n    newLocale: localeCode,\n    from: route.name,\n  });\n};\n\nconst updateLastActivePortal = async localeCode => {\n  const { last_active_locale_code: lastActiveLocaleCode } =\n    uiSettings.value || {};\n  const defaultLocale = props.portal.meta.default_locale;\n\n  // Update UI settings only if deleting locale matches the last active locale in UI settings.\n  if (localeCode === lastActiveLocaleCode) {\n    await updateUISettings({\n      last_active_locale_code: defaultLocale,\n    });\n  }\n};\n\nconst deletePortalLocale = async ({ localeCode }) => {\n  const updatedLocales = props.locales\n    .filter(locale => locale.code !== localeCode)\n    .map(locale => locale.code);\n\n  const defaultLocale = props.portal.meta.default_locale;\n\n  await updatePortalLocales({\n    newAllowedLocales: updatedLocales,\n    defaultLocale,\n    messageKey: 'DELETE_LOCALE',\n  });\n\n  await updateLastActivePortal(localeCode);\n\n  useTrack(PORTALS_EVENTS.DELETE_LOCALE, {\n    deletedLocale: localeCode,\n    from: route.name,\n  });\n};\n\nconst handleAction = ({ action }, localeCode) => {\n  if (action === 'change-default') {\n    changeDefaultLocale({ localeCode: localeCode });\n  } else if (action === 'delete') {\n    deletePortalLocale({ localeCode: localeCode });\n  }\n};\n</script>\n\n<template>\n  <ul role=\"list\" class=\"w-full h-full space-y-4\">\n    <LocaleCard\n      v-for=\"(locale, index) in locales\"\n      :key=\"index\"\n      :locale=\"locale.name\"\n      :is-default=\"isLocaleDefault(locale.code)\"\n      :locale-code=\"locale.code\"\n      :article-count=\"locale.articlesCount || 0\"\n      :category-count=\"locale.categoriesCount || 0\"\n      @action=\"handleAction($event, locale.code)\"\n    />\n  </ul>\n</template>\n","<script setup>\nimport { ref, computed } from 'vue';\nimport { useI18n } from 'vue-i18n';\nimport { useStore } from 'dashboard/composables/store';\nimport { useAlert, useTrack } from 'dashboard/composables';\nimport { useRoute } from 'vue-router';\nimport { PORTALS_EVENTS } from 'dashboard/helper/AnalyticsHelper/events';\nimport allLocales from 'shared/constants/locales.js';\nimport Dialog from 'dashboard/components-next/dialog/Dialog.vue';\nimport ComboBox from 'dashboard/components-next/combobox/ComboBox.vue';\n\nconst props = defineProps({\n  portal: {\n    type: Object,\n    default: () => ({}),\n  },\n});\n\nconst { t } = useI18n();\nconst store = useStore();\nconst route = useRoute();\n\nconst dialogRef = ref(null);\nconst isUpdating = ref(false);\n\nconst selectedLocale = ref('');\n\nconst addedLocales = computed(() => {\n  const { allowed_locales: allowedLocales = [] } = props.portal?.config || {};\n  return allowedLocales.map(locale => locale.code);\n});\n\nconst locales = computed(() => {\n  return Object.keys(allLocales)\n    .map(key => {\n      return {\n        value: key,\n        label: `${allLocales[key]} (${key})`,\n      };\n    })\n    .filter(locale => !addedLocales.value.includes(locale.value));\n});\n\nconst onCreate = async () => {\n  if (!selectedLocale.value) return;\n\n  isUpdating.value = true;\n  const updatedLocales = [...addedLocales.value, selectedLocale.value];\n\n  try {\n    await store.dispatch('portals/update', {\n      portalSlug: props.portal?.slug,\n      config: {\n        allowed_locales: updatedLocales,\n        default_locale: props.portal?.meta?.default_locale,\n      },\n    });\n\n    useTrack(PORTALS_EVENTS.CREATE_LOCALE, {\n      localeAdded: selectedLocale.value,\n      totalLocales: updatedLocales.length,\n      from: route.name,\n    });\n\n    dialogRef.value?.close();\n    useAlert(\n      t('HELP_CENTER.LOCALES_PAGE.ADD_LOCALE_DIALOG.API.SUCCESS_MESSAGE')\n    );\n  } catch (error) {\n    useAlert(\n      error?.message ||\n        t('HELP_CENTER.LOCALES_PAGE.ADD_LOCALE_DIALOG.API.ERROR_MESSAGE')\n    );\n  } finally {\n    isUpdating.value = false;\n  }\n};\n\n// Expose the dialogRef to the parent component\ndefineExpose({ dialogRef });\n</script>\n\n<template>\n  <Dialog\n    ref=\"dialogRef\"\n    type=\"edit\"\n    :title=\"t('HELP_CENTER.LOCALES_PAGE.ADD_LOCALE_DIALOG.TITLE')\"\n    :description=\"t('HELP_CENTER.LOCALES_PAGE.ADD_LOCALE_DIALOG.DESCRIPTION')\"\n    @confirm=\"onCreate\"\n  >\n    <div class=\"flex flex-col gap-6\">\n      <ComboBox\n        v-model=\"selectedLocale\"\n        :options=\"locales\"\n        :placeholder=\"\n          t('HELP_CENTER.LOCALES_PAGE.ADD_LOCALE_DIALOG.COMBOBOX.PLACEHOLDER')\n        \"\n        class=\"[&>div>button:not(.focused)]:!outline-n-slate-5 [&>div>button:not(.focused)]:dark:!outline-n-slate-5\"\n      />\n    </div>\n  </Dialog>\n</template>\n","<script setup>\nimport { computed, ref } from 'vue';\nimport { useMapGetter } from 'dashboard/composables/store.js';\n\nimport HelpCenterLayout from 'dashboard/components-next/HelpCenter/HelpCenterLayout.vue';\nimport Button from 'dashboard/components-next/button/Button.vue';\nimport Spinner from 'dashboard/components-next/spinner/Spinner.vue';\nimport LocaleList from 'dashboard/components-next/HelpCenter/Pages/LocalePage/LocaleList.vue';\nimport AddLocaleDialog from 'dashboard/components-next/HelpCenter/Pages/LocalePage/AddLocaleDialog.vue';\n\nconst props = defineProps({\n  locales: {\n    type: Array,\n    required: true,\n  },\n  portal: {\n    type: Object,\n    default: () => ({}),\n  },\n});\n\nconst addLocaleDialogRef = ref(null);\n\nconst isSwitchingPortal = useMapGetter('portals/isSwitchingPortal');\n\nconst openAddLocaleDialog = () => {\n  addLocaleDialogRef.value.dialogRef.open();\n};\n\nconst localeCount = computed(() => props.locales?.length);\n</script>\n\n<template>\n  <HelpCenterLayout :show-pagination-footer=\"false\">\n    <template #header-actions>\n      <div class=\"flex items-center justify-between\">\n        <div class=\"flex items-center gap-4\">\n          <span class=\"text-sm font-medium text-n-slate-12\">\n            {{ $t('HELP_CENTER.LOCALES_PAGE.LOCALES_COUNT', localeCount) }}\n          </span>\n        </div>\n        <Button\n          :label=\"$t('HELP_CENTER.LOCALES_PAGE.NEW_LOCALE_BUTTON_TEXT')\"\n          icon=\"i-lucide-plus\"\n          size=\"sm\"\n          @click=\"openAddLocaleDialog\"\n        />\n      </div>\n    </template>\n    <template #content>\n      <div\n        v-if=\"isSwitchingPortal\"\n        class=\"flex items-center justify-center py-10 text-n-slate-11\"\n      >\n        <Spinner />\n      </div>\n      <LocaleList v-else :locales=\"locales\" :portal=\"portal\" />\n    </template>\n    <AddLocaleDialog ref=\"addLocaleDialogRef\" :portal=\"portal\" />\n  </HelpCenterLayout>\n</template>\n","<script setup>\nimport { computed } from 'vue';\nimport { useRoute } from 'vue-router';\nimport { useMapGetter } from 'dashboard/composables/store.js';\nimport allLocales from 'shared/constants/locales.js';\n\nimport LocalesPage from 'dashboard/components-next/HelpCenter/Pages/LocalePage/LocalesPage.vue';\n\nconst route = useRoute();\n\nconst getPortalBySlug = useMapGetter('portals/portalBySlug');\n\nconst portal = computed(() => getPortalBySlug.value(route.params.portalSlug));\n\nconst allowedLocales = computed(() => {\n  if (!portal.value) {\n    return [];\n  }\n  const { allowed_locales: allAllowedLocales } = portal.value.config;\n  return allAllowedLocales.map(locale => {\n    return {\n      id: locale?.code,\n      name: allLocales[locale?.code],\n      code: locale?.code,\n      articlesCount: locale?.articles_count || 0,\n      categoriesCount: locale?.categories_count || 0,\n    };\n  });\n});\n</script>\n\n<template>\n  <LocalesPage :locales=\"allowedLocales\" :portal=\"portal\" />\n</template>\n"],"names":["props","__props","emit","__emit","t","useI18n","showDropdownMenu","toggleDropdown","useToggle","localeMenuItems","computed","LOCALE_MENU_ITEMS","item","handleAction","action","value","store","useStore","route","useRoute","uiSettings","updateUISettings","useUISettings","isLocaleDefault","code","_b","_a","updatePortalLocales","newAllowedLocales","defaultLocale","messageKey","alertMessage","error","useAlert","changeDefaultLocale","localeCode","locale","useTrack","PORTALS_EVENTS","updateLastActivePortal","lastActiveLocaleCode","deletePortalLocale","updatedLocales","dialogRef","ref","isUpdating","selectedLocale","addedLocales","allowedLocales","locales","allLocales","key","onCreate","_c","_d","__expose","addLocaleDialogRef","isSwitchingPortal","useMapGetter","openAddLocaleDialog","localeCount","getPortalBySlug","portal","allAllowedLocales"],"mappings":"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"}