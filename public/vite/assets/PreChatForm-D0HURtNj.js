import{C as ue}from"./Button-BR_kwxyB.js";import{m as ce,S as de,e as F}from"./useBranding-CD_QbCIP.js";import{g as me}from"./utils.esm-dig4nDxm.js";import{r as G,c as W,i as z,d as U}from"./widget-CCp9dnZb.js";import{g as pe}from"./Validators-DkQimdV0.js";import{u as he}from"./vue-dompurify-html-CEAHYyWB.js";import{F as fe,w as ve}from"./index-DJvhFcF9.js";import{r as b,X as $,c as R,w as be,I as X,p as m,o as c,s as f,i as I,g as C,a as A,e as k,t as g,q as j,k as P,W as ge,F as Q,j as Y,A as B,H as Ce,_ as J,n as w,l as q,y as _e,m as Ee}from"./_plugin-vue_export-helper-IoQslFd3.js";import{a as xe,g as Re,c as ye}from"./helper-q29O9VCT.js";import{F as K}from"./module-CEpankYo.js";import"./sharedFrameEvents-0qZ2yOho.js";import"./index-DN3rM4CW.js";import"./index-BtuGy7By.js";import"./constants-lVAyZKq6.js";import"./Icon-Dg_4WYMY.js";import"./Branding-DdXbg_Zm.js";import"./_commonjsHelpers-BosuxZz1.js";const Ae={class:"relative mt-2 phone-input--wrap"},we={key:0,class:"mb-0 text-xl"},Fe={key:0,class:"py-2 ltr:pl-2 rtl:pr-2 text-base text-n-slate-11"},Pe=["value","placeholder"],Ie={class:"sticky top-0 bg-n-background text-n-slate-12 dark:bg-n-solid-3"},ke=["placeholder"],Se=["onClick"],Oe={key:0,class:"mr-2 text-xl"},Ne={class:"text-sm leading-5 truncate"},Me={class:"ml-2 text-xs"},De={key:0},He={class:"flex justify-center mt-4 text-sm text-center text-n-slate-11"},Ve={__name:"PhoneInput",props:{context:{type:Object,default:()=>({})}},setup(e){const t=b(e.context.value||""),a=b(-1),o=b(!1),r=b(""),n=b(xe()),u=b(Re()),_=b(""),h=$("dropdownRef"),v=$("searchbarRef"),i=R(()=>{var s,l;return((l=(s=e.context)==null?void 0:s.attrs)==null?void 0:l.placeholder)||""}),E=R(()=>{var s,l;return(l=(s=e.context)==null?void 0:s.state)==null?void 0:l.invalid}),Z=R(()=>n.value?"Clear selection":"Select Country"),S=R(()=>[{name:Z.value,dial_code:"",emoji:"",id:""},...ye]),y=R(()=>S.value.filter(s=>{const{name:l,dial_code:x,id:d}=s,p=r.value.toLowerCase();return l.toLowerCase().includes(p)||x.toLowerCase().includes(p)||d.toLowerCase().includes(p)})),O=R(()=>S.value.find(s=>s.id===n.value));be(y,s=>{s.length<a.value+1&&(a.value=0)});function N(s){const l=Ce(s);t.value=`${l}${_.value}`,e.context.node.input(t.value)}function ee(s){_.value=s.target.value,N(u.value)}function M(s){var l;return o.value?Array.from((l=h.value)==null?void 0:l.querySelectorAll(`div.country-dropdown div.country-dropdown--item.${s}`)):[]}function D(s){var x,d;const l=s;if(l.length>0){const p=h.value,L=p.clientHeight,re=(x=l[0])==null?void 0:x.offsetTop,le=(d=l[0])==null?void 0:d.offsetHeight,ie=re-L/2+le/2;p.scrollTo({top:ie,behavior:"auto"})}}function te(){B(()=>{D(M("focus"))})}function H(s){if(!o.value)return;const l=y.value.length-1;s==="up"?a.value=a.value<=0?l:a.value-1:s==="down"&&(a.value=a.value>=l?0:a.value+1),te()}function ne(){H("up")}function ae(){H("down")}function V(){a.value=-1,o.value=!1}function T(s){n.value=s.id,r.value="",u.value=s.dial_code?s.dial_code:"",N(s.dial_code),V()}function se(){o.value=!o.value,a.value=-1,o.value&&B(()=>{v.value.focus(),D(M("active"))})}function oe(){!o.value||a.value===-1||T(y.value[a.value])}return(s,l)=>{const x=X("on-clickaway");return c(),m("div",Ae,[f("div",{class:j(["flex items-center justify-start outline-none phone-input rounded-lg box-border bg-n-background dark:bg-n-alpha-2 border-none outline outline-1 outline-offset-[-1px] text-sm w-full text-n-slate-12 focus-within:outline-n-brand focus-within:ring-1 focus-within:ring-n-brand",{"outline-n-ruby-8 dark:outline-n-ruby-8 hover:outline-n-ruby-9 dark:hover:outline-n-ruby-9":E.value,"outline-n-weak":!E.value}])},[f("div",{class:"flex items-center justify-between h-[2.625rem] px-2 py-2 cursor-pointer bg-n-alpha-1 dark:bg-n-solid-1 ltr:rounded-bl-lg rtl:rounded-br-lg ltr:rounded-tl-lg rtl:rounded-tr-lg min-w-[3.6rem] w-[3.6rem]",onClick:se},[O.value.emoji?(c(),m("h5",we,g(O.value.emoji),1)):(c(),A(K,{key:1,icon:"globe",class:"fluent-icon",size:"20"})),k(K,{icon:"chevron-down",class:"fluent-icon",size:"12"})]),u.value?(c(),m("span",Fe,g(u.value),1)):C("",!0),f("input",{value:_.value,type:"phoneInput",class:"w-full h-full !py-3 pl-2 pr-3 leading-tight rounded-r !outline-none focus:!ring-0 !bg-transparent dark:!bg-transparent",name:"phoneNumber",placeholder:i.value,onInput:ee,onBlur:l[0]||(l[0]=(...d)=>e.context.blurHandler&&e.context.blurHandler(...d))},null,40,Pe)],2),o.value?I((c(),m("div",{key:0,ref_key:"dropdownRef",ref:h,class:"country-dropdown absolute bg-n-background text-n-slate-12 dark:bg-n-solid-3 z-10 h-48 px-0 pt-0 pb-1 pl-1 pr-1 overflow-y-auto rounded-lg shadow-lg top-12 w-full min-w-24 max-w-[14.8rem]",onKeydown:[P(ne,["up"]),P(ae,["down"]),P(oe,["enter"])]},[f("div",Ie,[I(f("input",{ref_key:"searchbarRef",ref:v,"onUpdate:modelValue":l[1]||(l[1]=d=>r.value=d),type:"text",placeholder:s.$t("PRE_CHAT_FORM.FIELDS.PHONE_NUMBER.DROPDOWN_SEARCH"),class:"w-full h-8 !ring-0 px-3 py-2 mt-1 mb-1 text-sm rounded bg-n-alpha-black2"},null,8,ke),[[ge,r.value]])]),(c(!0),m(Q,null,Y(y.value,(d,p)=>(c(),m("div",{key:p,class:j(["flex items-center h-8 px-2 py-2 rounded cursor-pointer country-dropdown--item text-n-slate-12 dark:hover:bg-n-solid-2 hover:bg-n-alpha-2",[d.id===n.value&&"active bg-n-alpha-1 dark:bg-n-solid-1",p===a.value&&"focus dark:bg-n-solid-2 bg-n-alpha-2"]]),onClick:L=>T(d)},[d.emoji?(c(),m("span",Oe,g(d.emoji),1)):C("",!0),f("span",Ne,g(d.name),1),f("span",Me,g(d.dial_code),1)],10,Se))),128)),y.value.length===0?(c(),m("div",De,[f("span",He,g(s.$t("PRE_CHAT_FORM.FIELDS.PHONE_NUMBER.DROPDOWN_EMPTY")),1)])):C("",!0)],32)),[[x,V]]):C("",!0)])}}},Te={components:{CustomButton:ue,Spinner:de,FormKit:fe},mixins:[G,W],props:{options:{type:Object,default:()=>{}}},emits:["submitPreChat"],setup(){const e=ve(Ve,{props:["hasErrorInPhoneInput"]}),{formatMessage:t}=he();return{formatMessage:t,phoneInput:e}},data(){return{locale:this.$root.$i18n.locale,hasErrorInPhoneInput:!1,message:"",formValues:{},labels:{emailAddress:"EMAIL_ADDRESS",fullName:"FULL_NAME",phoneNumber:"PHONE_NUMBER"}}},computed:{...ce({widgetColor:"appConfig/getWidgetColor",isCreating:"conversation/getIsCreating",isConversationRouting:"appConfig/getIsUpdatingRoute",activeCampaign:"campaign/getActiveCampaign",currentUser:"contacts/getCurrentUser"}),isCreatingConversation(){return this.isCreating||this.isConversationRouting},textColor(){return me(this.widgetColor)},hasActiveCampaign(){return!z(this.activeCampaign)},shouldShowHeaderMessage(){return this.hasActiveCampaign||this.preChatFormEnabled&&!!this.headerMessage},headerMessage(){return this.preChatFormEnabled?this.options.preChatMessage:this.hasActiveCampaign?this.$t("PRE_CHAT_FORM.CAMPAIGN_HEADER"):""},preChatFields(){return this.preChatFormEnabled?this.options.preChatFields:[]},filteredPreChatFields(){const e=this.currentUser.has_email,t=this.currentUser.has_phone_number,o=!!(!!this.currentUser.identifier||e||t);return this.preChatFields.filter(r=>!(e&&r.name==="emailAddress"||t&&r.name==="phoneNumber"||o&&r.name==="fullName"))},enabledPreChatFields(){return this.filteredPreChatFields.filter(e=>e.enabled).map(e=>({...e,type:e.name==="phoneNumber"?this.phoneInput:this.findFieldType(e.type)}))},conversationCustomAttributes(){let e={};return this.enabledPreChatFields.forEach(t=>{t.field_type==="conversation_attribute"&&(e={...e,[t.name]:this.getValue(t)})}),e},contactCustomAttributes(){let e={};return this.enabledPreChatFields.forEach(t=>{t.field_type==="contact_attribute"&&(e={...e,[t.name]:this.getValue(t)})}),e}},methods:{labelClass(e){const{state:t}=e.context;return t.invalid?"text-n-ruby-10":"text-n-slate-12"},inputClass(e){const{state:t,family:a,type:o}=e.context,r=t.invalid;return a==="box"&&o==="checkbox"?"":(o==="phoneInput"&&(this.hasErrorInPhoneInput=r),r?"mt-1 rounded w-full py-2 px-3 error":"mt-1 rounded w-full py-2 px-3")},isContactFieldRequired(e){return this.preChatFields.find(t=>t.name===e).required},getLabel({label:e}){return e},getPlaceHolder({placeholder:e}){return e},getValue({name:e,type:t}){return t==="select"?this.enabledPreChatFields.find(a=>a.name===e).values[this.formValues[e]]:this.formValues[e]||null},getValidation({type:e,name:t,field_type:a,regex_pattern:o}){let r=o?pe(o):null;const n={emailAddress:"email",phoneNumber:["startsWithPlus","isValidPhoneNumber"],url:"url",date:"date",text:null,select:null,number:null,checkbox:!1,contact_attribute:r?[["matches",r]]:null,conversation_attribute:r?[["matches",r]]:null},u=Object.keys(n),h=this.isContactFieldRequired(t)?["required"]:["optional"];if(u.includes(t)||u.includes(e)||u.includes(a)){const v=n[e]||n[t]||n[a];return(v?h.concat(v):h).join("|")}return""},findFieldType(e){return e==="link"?"url":e==="list"?"select":e},getOptions(e){if(e.type==="select"){let t={};return e.values.forEach((a,o)=>{t={...t,[o]:a}}),t}return{}},onSubmit(){const{emailAddress:e,fullName:t,phoneNumber:a,message:o}=this.formValues;this.$emit("submitPreChat",{fullName:t,phoneNumber:a,emailAddress:e,message:o,activeCampaignId:this.activeCampaign.id,conversationCustomAttributes:this.conversationCustomAttributes,contactCustomAttributes:this.contactCustomAttributes})}}},Le={key:0,class:"mb-4 text-base leading-5 text-n-slate-12 [&>p>.link]:text-n-blue-text [&>p>.link]:hover:underline"};function Ue(e,t,a,o,r,n){const u=w("FormKit"),_=w("Spinner"),h=w("CustomButton"),v=X("dompurify-html");return c(),A(u,{modelValue:r.formValues,"onUpdate:modelValue":t[0]||(t[0]=i=>r.formValues=i),type:"form","form-class":"flex flex-col flex-1 w-full p-6 overflow-y-auto","incomplete-message":!1,"submit-attrs":{inputClass:"hidden",wrapperClass:"hidden"},onSubmit:n.onSubmit},{default:q(()=>[n.shouldShowHeaderMessage?I((c(),m("div",Le,null,512)),[[v,o.formatMessage(n.headerMessage,!1)]]):C("",!0),(c(!0),m(Q,null,Y(n.enabledPreChatFields,i=>(c(),A(u,_e({key:i.name,name:i.name,type:i.type,label:n.getLabel(i),placeholder:n.getPlaceHolder(i),validation:n.getValidation(i),ref_for:!0},i.type==="select"?{options:n.getOptions(i)}:void 0,{"label-class":E=>`text-sm font-medium ${n.labelClass(E)}`,"input-class":E=>n.inputClass(E),"validation-messages":{startsWithPlus:e.$t("PRE_CHAT_FORM.FIELDS.PHONE_NUMBER.DIAL_CODE_VALID_ERROR"),isValidPhoneNumber:e.$t("PRE_CHAT_FORM.FIELDS.PHONE_NUMBER.VALID_ERROR"),email:e.$t("PRE_CHAT_FORM.FIELDS.EMAIL_ADDRESS.VALID_ERROR"),required:e.$t("PRE_CHAT_FORM.REQUIRED"),matches:i.regex_cue?i.regex_cue:e.$t("PRE_CHAT_FORM.REGEX_ERROR")},"has-error-in-phone-input":r.hasErrorInPhoneInput}),null,16,["name","type","label","placeholder","validation","label-class","input-class","validation-messages","has-error-in-phone-input"]))),128)),n.hasActiveCampaign?C("",!0):(c(),A(u,{key:1,name:"message",type:"textarea","label-class":i=>`text-sm font-medium ${n.labelClass(i)}`,"input-class":i=>n.inputClass(i),label:e.$t("PRE_CHAT_FORM.FIELDS.MESSAGE.LABEL"),placeholder:e.$t("PRE_CHAT_FORM.FIELDS.MESSAGE.PLACEHOLDER"),validation:"required","validation-messages":{required:e.$t("PRE_CHAT_FORM.FIELDS.MESSAGE.ERROR")}},null,8,["label-class","input-class","label","placeholder","validation-messages"])),k(h,{class:"mt-3 mb-5 font-medium flex items-center justify-center gap-2",block:"","bg-color":e.widgetColor,"text-color":n.textColor,disabled:n.isCreatingConversation},{default:q(()=>[n.isCreatingConversation?(c(),A(_,{key:0,class:"p-0"})):C("",!0),Ee(" "+g(e.$t("START_CONVERSATION")),1)]),_:1},8,["bg-color","text-color","disabled"])]),_:1},8,["modelValue","onSubmit"])}const $e=J(Te,[["render",Ue]]),je={components:{PreChatForm:$e},mixins:[W,G],mounted(){F.on(U,this.handleConversationCreated)},beforeUnmount(){F.off(U,this.handleConversationCreated)},methods:{handleConversationCreated(){this.replaceRoute("messages")},onSubmit({fullName:e,emailAddress:t,message:a,activeCampaignId:o,phoneNumber:r,contactCustomAttributes:n,conversationCustomAttributes:u}){o?(F.emit("execute-campaign",{campaignId:o,customAttributes:u}),this.$store.dispatch("contacts/update",{user:{email:t,name:e,phone_number:r}})):this.$store.dispatch("conversation/createConversation",{fullName:e,emailAddress:t,message:a,phoneNumber:r,customAttributes:u}),z(n)||this.$store.dispatch("contacts/setCustomAttributes",n)}}},Be={class:"flex flex-1 overflow-auto"};function qe(e,t,a,o,r,n){const u=w("PreChatForm",!0);return c(),m("div",Be,[k(u,{options:e.preChatFormOptions,onSubmitPreChat:n.onSubmit},null,8,["options","onSubmitPreChat"])])}const it=J(je,[["render",qe]]);export{it as default};
//# sourceMappingURL=PreChatForm-D0HURtNj.js.map
