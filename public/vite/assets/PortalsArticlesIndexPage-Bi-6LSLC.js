import{_ as le,r as U,c as s,w as K,a as _,o as p,l as k,s as H,q as se,H as S,p as M,e as w,g as B,F as oe,j as re,P as ce}from"./_plugin-vue_export-helper-IoQslFd3.js";import{a as W,u as G}from"./Validators-DkQimdV0.js";import{b as J,u as V,c as L}from"./useBranding-CD_QbCIP.js";import{_ as Q,D as ne,g as X,u as ie,A as ue,a as Z,C as ee,b as de,c as F,O as Y,d as ge,e as me,l as pe}from"./dashboard-B8DxvGhj.js";import{_ as Ae}from"./HelpCenterLayout-Cxv-mUuH.js";import{u as D,a as j}from"./index-DyRF4TQi.js";import{an as z}from"./DashboardIcon-D9a-qnXf.js";import{w as Ce}from"./globals-DPjCpsAT.js";import{_ as O,a as ve}from"./exports-Db5CWii1.js";import{_ as _e}from"./CategoryHeaderControls-RyLNzmNJ.js";import"./index-DN3rM4CW.js";import"./index-BtuGy7By.js";import"./_commonjsHelpers-BosuxZz1.js";import"./index-DJvhFcF9.js";import"./typing-B_xc7lBt.js";import"./vue-dompurify-html-CEAHYyWB.js";import"./utils.esm-dig4nDxm.js";import"./useKeyboardNavigableList-DBoi-hid.js";import"./helper-q29O9VCT.js";import"./Icon-Dg_4WYMY.js";import"./Avatar-CS4GuSbz.js";import"./module-CEpankYo.js";import"./BarChart-CqJKiiio.js";import"./constants-lVAyZKq6.js";import"./IframeLoader-BKISZm2C.js";import"./js.cookie-Cz0CWeBA.js";const Ee={class:"list-none rounded-2xl"},he={__name:"ArticleList",props:{articles:{type:Array,required:!0},isCategoryArticles:{type:Boolean,default:!1}},setup(n){const i=n,{ARTICLE_STATUS_TYPES:o}=Ce,C=W(),A=G(),m=J(),{t:g}=V(),u=U(i.articles),v=s(()=>{var a;return i.isCategoryArticles&&((a=u.value)==null?void 0:a.length)>1}),T=L("categories/categoryById"),f=a=>{const{tab:r,categorySlug:e,locale:t}=A.params;i.isCategoryArticles?C.push({name:"portals_categories_articles_edit",params:{articleSlug:a}}):C.push({name:"portals_articles_edit",params:{articleSlug:a,tab:r,categorySlug:e,locale:t}})},I=a=>{m.dispatch("articles/reorder",{reorderedGroup:a,portalSlug:A.params.portalSlug})},R=()=>{const a=u.value.map(t=>t.position).sort((t,l)=>t-l),e=u.value.map(t=>t.id).reduce((t,l,d)=>(t[l]=a[d],t),{});I(e)},P=a=>T.value(a)||{name:"",icon:""},E=(a,r)=>{const e=r?"SUCCESS":"ERROR",t={[o.PUBLISH]:"PUBLISH_ARTICLE",[o.ARCHIVE]:"ARCHIVE_ARTICLE",[o.DRAFT]:"DRAFT_ARTICLE"};return t[a]?g(`HELP_CENTER.${t[a]}.API.${e}`):""},h=()=>{const{portalSlug:a,locale:r}=A.params;return m.dispatch("portals/show",{portalSlug:a,locale:r})},x=()=>{const{portalSlug:a,locale:r}=A.params;return m.dispatch("articles/updateArticleMeta",{portalSlug:a,locale:r})},N=async(a,{status:r,id:e})=>{const{portalSlug:t}=A.params;try{a==="delete"?(await m.dispatch("articles/delete",{portalSlug:t,articleId:e}),D(g("HELP_CENTER.DELETE_ARTICLE.API.SUCCESS_MESSAGE"))):(await m.dispatch("articles/update",{portalSlug:t,articleId:e,status:r}),D(E(r,!0)),r===o.ARCHIVE?j(z.ARCHIVE_ARTICLE,{uiFrom:"header"}):r===o.PUBLISH&&j(z.PUBLISH_ARTICLE)),await x(),await h()}catch(l){const d=(l==null?void 0:l.message)||(a==="delete"?g("HELP_CENTER.DELETE_ARTICLE.API.ERROR_MESSAGE"):E(r,!1));D(d)}},b=({action:a,value:r,id:e})=>{const t=a!=="delete"?X(r):null;N(a,{status:t,id:e})};return K(()=>i.articles,a=>{u.value=a},{deep:!0}),(a,r)=>(p(),_(S(ne),{modelValue:u.value,"onUpdate:modelValue":r[0]||(r[0]=e=>u.value=e),disabled:!v.value,"item-key":"id",tag:"ul","ghost-class":"article-ghost-class",class:"w-full h-full space-y-4",onEnd:R},{item:k(({element:e})=>[H("li",Ee,[(p(),_(Q,{id:e.id,key:e.id,title:e.title,status:e.status,author:e.author,category:P(e.category.id),views:e.views||0,"updated-at":e.updatedAt,class:se({"cursor-grab":v.value}),onOpenArticle:f,onArticleAction:b},null,8,["id","title","status","author","category","views","updated-at","class"]))])]),_:1},8,["modelValue","disabled"]))}},ye=le(he,[["__scopeId","data-v-a8274486"]]),fe={class:"flex flex-col items-start w-full gap-2 lg:flex-row"},Se={class:"flex items-start justify-between w-full gap-2"},Le={class:"flex items-center gap-2"},Te={class:"relative group"},be={key:0,class:"relative group"},we={__name:"ArticleHeaderControls",props:{categories:{type:Array,required:!0},allowedLocales:{type:Array,required:!0},meta:{type:Object,required:!0}},emits:["tabChange","localeChange","categoryChange","newArticle"],setup(n,{emit:i}){const o=n,C=i,A=G(),{t:m}=V(),{updateUISettings:g}=ie(),u=U(!1),v=U(!1),T=e=>e.value==="all"?"articlesCount":`${e.value}ArticlesCount`,f=s(()=>ue.map(e=>({label:m(`HELP_CENTER.ARTICLES_PAGE.ARTICLES_HEADER.TABS.${e.key}`),value:e.value,count:o.meta[T(e)]}))),I=s(()=>{const e=A.params.tab||Z.ALL;return f.value.findIndex(t=>t.value===e)}),R=s(()=>{const e=o.categories.find(t=>t.slug===A.params.categorySlug);if(e){const{icon:t,name:l}=e;return`${t} ${l}`}return m("HELP_CENTER.ARTICLES_PAGE.ARTICLES_HEADER.CATEGORY.ALL")}),P=s(()=>{var e;return(e=o.allowedLocales.find(t=>t.code===A.params.locale))==null?void 0:e.name}),E=s(()=>{const e={label:m("HELP_CENTER.ARTICLES_PAGE.ARTICLES_HEADER.CATEGORY.ALL"),value:ee,action:"filter"},t=o.categories.map(d=>({label:d.name,value:d.slug,action:"filter",emoji:d.icon}));return!!A.params.categorySlug?[e,...t]:t}),h=s(()=>{var e;return((e=E.value)==null?void 0:e.length)>0}),x=s(()=>o.allowedLocales.map(e=>({label:e.name,value:e.code,action:"filter"}))),N=({value:e})=>{C("localeChange",e),v.value=!1,g({last_active_locale_code:e})},b=({value:e})=>{C("categoryChange",e),u.value=!1},a=()=>{C("newArticle")},r=e=>{C("tabChange",e)};return(e,t)=>(p(),M("div",fe,[w(de,{tabs:f.value,"initial-active-tab":I.value,onTabChanged:r},null,8,["tabs","initial-active-tab"]),H("div",Se,[H("div",Le,[H("div",Te,[w(S(Y),{onTrigger:t[1]||(t[1]=l=>v.value=!1)},{default:k(()=>[w(O,{label:P.value,size:"sm",icon:"i-lucide-chevron-down",color:"slate","trailing-icon":"",onClick:t[0]||(t[0]=l=>v.value=!v.value)},null,8,["label"]),v.value?(p(),_(F,{key:0,"menu-items":x.value,"show-search":"",class:"left-0 w-40 max-w-[300px] mt-2 overflow-y-auto xl:right-0 top-full max-h-60",onAction:N},null,8,["menu-items"])):B("",!0)]),_:1})]),h.value?(p(),M("div",be,[w(S(Y),{onTrigger:t[3]||(t[3]=l=>u.value=!1)},{default:k(()=>[w(O,{label:R.value,icon:"i-lucide-chevron-down",size:"sm",color:"slate","trailing-icon":"",class:"max-w-48",onClick:t[2]||(t[2]=l=>u.value=!u.value)},null,8,["label"]),u.value?(p(),_(F,{key:0,"menu-items":E.value,"show-search":"",class:"left-0 w-48 mt-2 overflow-y-auto xl:right-0 top-full max-h-60",onAction:b},null,8,["menu-items"])):B("",!0)]),_:1})])):B("",!0)]),w(O,{label:S(m)("HELP_CENTER.ARTICLES_PAGE.ARTICLES_HEADER.NEW_ARTICLE"),icon:"i-lucide-plus",size:"sm",onClick:a},null,8,["label"])])]))}},Ie={class:"grid grid-cols-1 gap-4 p-px overflow-hidden"},Re={key:0},Pe={__name:"ArticleEmptyState",props:{title:{type:String,default:""},subtitle:{type:String,default:""},showButton:{type:Boolean,default:!0},buttonLabel:{type:String,default:""}},emits:["click"],setup(n,{emit:i}){const o=i,C=()=>{o("click")};return(A,m)=>(p(),_(me,{title:n.title,subtitle:n.subtitle},{"empty-state-item":k(()=>[H("div",Ie,[(p(!0),M(oe,null,re(S(ge).slice(0,5),(g,u)=>(p(),_(Q,{id:g.id,key:`article-${u}`,title:g.title,status:g.status,"updated-at":g.updatedAt,author:g.author,category:g.category,views:g.views},null,8,["id","title","status","updated-at","author","category","views"]))),128))])]),actions:k(()=>[n.showButton?(p(),M("div",Re,[w(O,{label:n.buttonLabel,icon:"i-lucide-plus",onClick:C},null,8,["label"])])):B("",!0)]),_:1},8,["title","subtitle"]))}},xe={class:"flex items-end justify-between"},Ne={key:0,class:"flex items-center justify-center py-10 text-n-slate-11"},$e={__name:"ArticlesPage",props:{articles:{type:Array,required:!0},categories:{type:Array,required:!0},allowedLocales:{type:Array,required:!0},portalName:{type:String,required:!0},meta:{type:Object,required:!0},isCategoryArticles:{type:Boolean,default:!1}},emits:["pageChange","fetchPortal"],setup(n,{emit:i}){const o=n,C=i,A=W(),m=G(),{t:g}=V(),u=L("portals/isSwitchingPortal"),v=L("articles/isFetching"),T=s(()=>!v.value&&!o.articles.length),f=s(()=>v.value||u.value),I=s(()=>o.meta.allArticlesCount),R=s(()=>I.value===0&&!o.isCategoryArticles),P=s(()=>!(v.value||u.value||T.value)),E=c=>{const{portalSlug:y,locale:$,tab:te,categorySlug:ae}=m.params;A.push({name:"portals_articles_index",params:{portalSlug:y,locale:c.locale??$,tab:c.tab??te,categorySlug:c.categorySlug??ae,...c}})},h=s(()=>{const{tab:c}=m.params,{meta:y}=o,$={"":y.articlesCount,mine:y.mineArticlesCount,draft:y.draftArticlesCount,archived:y.archivedArticlesCount};return Number($[c]||$[""])}),x=s(()=>!o.isCategoryArticles&&!u.value),N=s(()=>o.isCategoryArticles&&!u.value),b=c=>{var $;if(o.isCategoryArticles)return g(`HELP_CENTER.ARTICLES_PAGE.EMPTY_STATE.CATEGORY.${c}`);const y=(($=m.params.tab)==null?void 0:$.toUpperCase())||"ALL";return g(`HELP_CENTER.ARTICLES_PAGE.EMPTY_STATE.${y}.${c}`)},a=s(()=>b("TITLE")),r=s(()=>b("SUBTITLE")),e=c=>E({tab:c.value===Z.ALL?"":c.value}),t=c=>E({categorySlug:c===ee?"":c}),l=c=>{E({locale:c,categorySlug:""}),C("fetchPortal",c)},d=c=>C("pageChange",c),q=()=>{const{categorySlug:c,locale:y}=m.params;A.push({name:"portals_articles_new",params:{categorySlug:c,locale:y}})};return(c,y)=>(p(),_(Ae,{"current-page":Number(n.meta.currentPage),"total-items":h.value,"items-per-page":25,header:n.portalName,"show-pagination-footer":P.value,"onUpdate:currentPage":d},{"header-actions":k(()=>[H("div",xe,[x.value?(p(),_(we,{key:0,categories:n.categories,"allowed-locales":n.allowedLocales,meta:n.meta,onTabChange:e,onLocaleChange:l,onCategoryChange:t,onNewArticle:q},null,8,["categories","allowed-locales","meta"])):N.value?(p(),_(_e,{key:1,categories:n.categories,"allowed-locales":n.allowedLocales,"has-selected-category":n.isCategoryArticles},null,8,["categories","allowed-locales","has-selected-category"])):B("",!0)])]),content:k(()=>[f.value?(p(),M("div",Ne,[w(ve)])):T.value?(p(),_(Pe,{key:2,class:"pt-14",title:a.value,subtitle:r.value,"show-button":R.value,"button-label":S(g)("HELP_CENTER.ARTICLES_PAGE.EMPTY_STATE.ALL.BUTTON_LABEL"),onClick:q},null,8,["title","subtitle","show-button","button-label"])):(p(),_(ye,{key:1,articles:n.articles,"is-category-articles":n.isCategoryArticles},null,8,["articles","is-category-articles"]))]),_:1},8,["current-page","total-items","header","show-pagination-footer"]))}},ke={class:"w-full h-full"},ct={__name:"PortalsArticlesIndexPage",setup(n){const i=G(),o=J(),C=U(1),A=L("articles/allArticles"),m=L("categories/allCategories"),g=L("articles/getMeta"),u=L("portals/getMeta"),v=L("getCurrentUserID"),T=L("portals/portalBySlug"),f=s(()=>i.params.portalSlug),I=s(()=>i.params.categorySlug),R=s(()=>X(i.params.tab)),P=s(()=>i.params.tab==="mine"?v.value:null),E=s(()=>i.params.locale),h=s(()=>T.value(f.value)),x=s(()=>{if(!h.value)return[];const{allowed_locales:l}=h.value.config;return l.map(d=>({id:d.code,name:pe[d.code],code:d.code}))}),N=s(()=>{var l,d;return(d=(l=h.value)==null?void 0:l.meta)==null?void 0:d.default_locale}),b=s(()=>i.params.locale||N.value),a=s(()=>i.name==="portals_categories_articles_index"||i.name==="portals_categories_articles_edit"||i.name==="portals_categories_index"),r=({pageNumber:l}={})=>{o.dispatch("articles/index",{pageNumber:l||C.value,portalSlug:f.value,locale:E.value,status:R.value,authorId:P.value,categorySlug:I.value})},e=l=>{r({pageNumber:l})},t=async l=>{await o.dispatch("portals/index");const d={portalSlug:f.value,locale:l||b.value};o.dispatch("portals/show",d),o.dispatch("categories/index",d),o.dispatch("agents/get")};return ce(()=>{r()}),K(()=>i.params,()=>{C.value=1,r()},{deep:!0,immediate:!0}),(l,d)=>(p(),M("div",ke,[h.value?(p(),_($e,{key:0,articles:S(A),"portal-name":h.value.name,categories:S(m),"allowed-locales":x.value,meta:S(g),"portal-meta":S(u),"is-category-articles":a.value,onPageChange:e,onFetchPortal:t},null,8,["articles","portal-name","categories","allowed-locales","meta","portal-meta","is-category-articles"])):B("",!0)]))}};export{ct as default};
//# sourceMappingURL=PortalsArticlesIndexPage-Bi-6LSLC.js.map
